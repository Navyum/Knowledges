<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="keywords" content="è‡ªæˆ‘æå‡,æ•ˆç‡æå‡,èŒåœºç»éªŒ,å­¦ä¹ ç¬”è®°" />
    <meta name="360-site-verification" content="deb32fab1ab57ddf02d8c5b4cc37025c" />
    <meta name="msvalidate.01" content="034FE00C2DAE4BC3B10D36ABBE467614" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #4089ab;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <!--  #252232 --> 
    <meta property="og:url" content="https://myblog.camscanner.top/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/golang%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html"><meta property="og:site_name" content="Navyum's Blog"><meta property="og:title" content="golangå­¦ä¹ ç¬”è®°"><meta property="og:description" content="omitemptyè¸©å‘ åœºæ™¯ï¼šjsonã€structè½¬æ¢ æè¿°ï¼šåœ¨http responseç»“æ„ä½“ä¸­ä¸è¦éšæ„ä½¿ç”¨ é™·é˜±ï¼š æ— æ³•å¿½ç•¥æ‰åµŒå¥—ç»“æ„ä½“ ç»™å®ƒèµ‹çš„å€¼æ°å¥½ç­‰äºé»˜è®¤ç©ºå€¼,ä¼šè¢«å¿½ç•¥ è¡¥å……ï¼šå› ä¸ºgoçš„å˜é‡æœ‰é»˜è®¤å€¼ï¼Œintä¸º0ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡å®šä¹‰çš„æ­£å¸¸å€¼0ä¸è¿”å› ä¸¾ä¾‹ï¼š replaceçš„ä½¿ç”¨ åœºæ™¯ï¼š å¤šä¸ªé¡¹ç›®åŒ…ï¼Œæœ¬åœ°å¼•ç”¨ æè¿°ï¼š å¦‚æœå½“å‰é¡¹ç›®ä½¿ç”¨äº†å…¶ä»–gitl..."><meta property="og:type" content="article"><meta property="og:image" content="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/b290f1ee1f29670d608c425edfec2d96.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-06-21T14:30:17.000Z"><meta property="article:author" content="navyum"><meta property="article:tag" content="ç¬”è®°"><meta property="article:published_time" content="2025-06-21T22:24:10.000Z"><meta property="article:modified_time" content="2025-06-21T14:30:17.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"golangå­¦ä¹ ç¬”è®°","image":["https://raw.staticdn.net/Navyum/imgbed/pic/IMG/b290f1ee1f29670d608c425edfec2d96.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/85ada42f30bc8039720da3c7c03a1bbd.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/53c95ad4fd4efeab51fee825eec022ba.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/826ab9aff0dd5f0077ccdeef32bbd96f.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/7951eca316c22aebc3f3632a045a296d.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/ae454158ac349742cf7217c472eed8ba.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/48bd79bfd4ffca1fc578a6698cf9acf0.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/ee5b938c62f75a47aae6c7400f0358f7.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/7718933e3b9eef5324dcfec3ac53aa2b.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/c1c6bafe989c43be7b23e474d0668f24.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/a11695f322399e06a43b359adc2e4148.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/341ae661ef2b4867952a913a4681448f.png"],"datePublished":"2025-06-21T22:24:10.000Z","dateModified":"2025-06-21T14:30:17.000Z","author":[{"@type":"Person","name":"navyum"}]}</script><link rel="alternate" type="application/atom+xml" href="https://myblog.camscanner.top/atom.xml" title="Navyum's Blog Atom Feed"><link rel="alternate" type="application/json" href="https://myblog.camscanner.top/feed.json" title="Navyum's Blog JSON Feed"><link rel="alternate" type="application/rss+xml" href="https://myblog.camscanner.top/rss.xml" title="Navyum's Blog RSS Feed"><link rel="icon" href="/favicon.ico"><title>golangå­¦ä¹ ç¬”è®° | Navyum's Blog</title><meta name="description" content="omitemptyè¸©å‘ åœºæ™¯ï¼šjsonã€structè½¬æ¢ æè¿°ï¼šåœ¨http responseç»“æ„ä½“ä¸­ä¸è¦éšæ„ä½¿ç”¨ é™·é˜±ï¼š æ— æ³•å¿½ç•¥æ‰åµŒå¥—ç»“æ„ä½“ ç»™å®ƒèµ‹çš„å€¼æ°å¥½ç­‰äºé»˜è®¤ç©ºå€¼,ä¼šè¢«å¿½ç•¥ è¡¥å……ï¼šå› ä¸ºgoçš„å˜é‡æœ‰é»˜è®¤å€¼ï¼Œintä¸º0ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡å®šä¹‰çš„æ­£å¸¸å€¼0ä¸è¿”å› ä¸¾ä¾‹ï¼š replaceçš„ä½¿ç”¨ åœºæ™¯ï¼š å¤šä¸ªé¡¹ç›®åŒ…ï¼Œæœ¬åœ°å¼•ç”¨ æè¿°ï¼š å¦‚æœå½“å‰é¡¹ç›®ä½¿ç”¨äº†å…¶ä»–gitl...">
    <link rel="stylesheet" href="/assets/css/styles.08b9eca3.css">
    <link rel="preload" href="/assets/js/runtime~app.4343b326.js" as="script"><link rel="preload" href="/assets/css/styles.08b9eca3.css" as="style"><link rel="preload" href="/assets/js/1181.88d0b359.js" as="script"><link rel="preload" href="/assets/js/app.0aa5305f.js" as="script">
    
    <!-- ç»Ÿè®¡ä»£ç åŒºåŸŸ-->
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/" aria-label="å¸¦æˆ‘å›å®¶"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">Navyum&#39;s Blog</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="ä¸»é¡µ" iconsizing="height"><!--[--><iconify-icon class="vp-icon" icon="meteor-icons:home" height="1em" sizing="height"></iconify-icon><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/blog.html" aria-label="åšå®¢" iconsizing="height"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:blog" height="1em" sizing="height"></iconify-icon><!--]-->åšå®¢<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ€è€ƒ"><!--[--><iconify-icon class="vp-icon" icon="icon-park-outline:thinking-problem" height="1em" sizing="height"></iconify-icon>æ€è€ƒ<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E9%9D%A2%E8%AF%95%E7%BB%8F%E9%AA%8C/" aria-label="é¢è¯•ç»éªŒ" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="fluent:people-chat-24-regular" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->é¢è¯•ç»éªŒ<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E4%B8%AA%E4%BA%BA%E6%80%9D%E8%80%83/" aria-label="ä¸ªäººæ€è€ƒ" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="icon-park-outline:thinking-problem" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->ä¸ªäººæ€è€ƒ<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E6%88%91%E7%9A%84%E4%B8%96%E7%95%8C/" aria-label="æˆ‘çš„ä¸–ç•Œ" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="streamline-plump:world-remix" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->æˆ‘çš„ä¸–ç•Œ<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="auto-link external-link" href="https://www.notion.so/navyum/1c42fcd1fefa4e948d8514761b2ab8c7?v=0ca5dc6ee29e4c2787dbd0f1055b4ed0" aria-label="è¯»ä¹¦" rel="noopener noreferrer" target="_blank" iconsizing="height"><!--[--><iconify-icon class="vp-icon" icon="fa6-brands:readme" height="1em" sizing="height"></iconify-icon><!--]-->è¯»ä¹¦<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/intro.html" aria-label="è”ç³»" iconsizing="height"><!--[--><iconify-icon class="vp-icon" icon="streamline-plump:contact-phonebook-solid" height="1em" sizing="height"></iconify-icon><!--]-->è”ç³»<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/map.html" aria-label="å¯¼èˆª" iconsizing="height"><!--[--><iconify-icon class="vp-icon" icon="streamline-plump:world-remix" height="1em" sizing="height"></iconify-icon><!--]-->å¯¼èˆª<!----></a></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/navyum" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="æœç´¢æ–‡æ¡£"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">æœç´¢æ–‡æ¡£</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><iconify-icon class="vp-icon" icon="codicon:code" width="1em" height="1em" sizing="both"></iconify-icon><span class="vp-sidebar-title">ç¼–ç¨‹è¯­è¨€</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Golang</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/array%E3%80%81slice.html" aria-label="arrayã€slice" iconsizing="both"><!---->arrayã€slice<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/CSP%E3%80%81channel.html" aria-label="CSPã€channel" iconsizing="both"><!---->CSPã€channel<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/gc.html" aria-label="gc" iconsizing="both"><!---->gc<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/golang%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" aria-label="golangå­¦ä¹ ç¬”è®°" iconsizing="both"><!---->golangå­¦ä¹ ç¬”è®°<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/goroutine.html" aria-label="goroutine" iconsizing="both"><!---->goroutine<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/interface.html" aria-label="interface" iconsizing="both"><!---->interface<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/interface%E5%92%8Cstruct%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF.html" aria-label="interfaceå’Œstructçš„ä½¿ç”¨åœºæ™¯" iconsizing="both"><!---->interfaceå’Œstructçš„ä½¿ç”¨åœºæ™¯<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/map.html" aria-label="map" iconsizing="both"><!---->map<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/options%E5%87%BD%E6%95%B0%E9%80%89%E9%A1%B9%E6%A8%A1%E5%BC%8F.html" aria-label="optionså‡½æ•°é€‰é¡¹æ¨¡å¼" iconsizing="both"><!---->optionså‡½æ•°é€‰é¡¹æ¨¡å¼<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/panic%E3%80%81recover%E3%80%81defer.html" aria-label="panicã€recoverã€defer" iconsizing="both"><!---->panicã€recoverã€defer<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/select.html" aria-label="select" iconsizing="both"><!---->select<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">å­¦ä¹ èµ„æ–™æ±‡æ€»</span><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.html" aria-label="æ•°æ®ç±»å‹" iconsizing="both"><!---->æ•°æ®ç±»å‹<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">æ ‡å‡†åº“</span><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%92%8C%E6%96%AD%E8%A8%80.html" aria-label="ç±»å‹è½¬æ¢å’Œæ–­è¨€" iconsizing="both"><!---->ç±»å‹è½¬æ¢å’Œæ–­è¨€<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">JAVA</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Lua</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Python</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->golangå­¦ä¹ ç¬”è®°</h1><div class="page-info"><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color3 clickable" role="navigation">ç¬”è®°</span><span class="page-category-item color8 clickable" role="navigation">è¸©å‘ç¬”è®°</span><!--]--><meta property="articleSection" content="ç¬”è®°,è¸©å‘ç¬”è®°"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color3 clickable" role="navigation">ç¬”è®°</span><!--]--><meta property="keywords" content="ç¬”è®°"></span><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 5587 å­—</span><meta property="wordCount" content="5587"></span><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 19 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT19M"></span><span class="page-pageview-info" aria-label="è®¿é—®é‡ğŸ”¢" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon" name="eye"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span id="ArtalkPV" class="vp-pageview waline-pageview-count" data-path="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/golang%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" data-page-key="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/golang%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html">...</span></span></div><hr></div><!----><!----><div class="theme-hope-content" vp-content><h3 id="omitemptyè¸©å‘" tabindex="-1"><a class="header-anchor" href="#omitemptyè¸©å‘"><span>omitemptyè¸©å‘</span></a></h3><ul><li>åœºæ™¯ï¼šjsonã€structè½¬æ¢</li><li>æè¿°ï¼šåœ¨http responseç»“æ„ä½“ä¸­ä¸è¦éšæ„ä½¿ç”¨</li><li>é™·é˜±ï¼š <ul><li>æ— æ³•å¿½ç•¥æ‰åµŒå¥—ç»“æ„ä½“</li><li>ç»™å®ƒèµ‹çš„å€¼æ°å¥½ç­‰äºé»˜è®¤ç©ºå€¼,ä¼šè¢«å¿½ç•¥</li></ul></li><li>è¡¥å……ï¼šå› ä¸ºgoçš„å˜é‡æœ‰é»˜è®¤å€¼ï¼Œintä¸º0ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡å®šä¹‰çš„æ­£å¸¸å€¼0ä¸è¿”å›</li><li>ä¸¾ä¾‹ï¼š</li></ul><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> PdfResponse</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        Ret</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  uint8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    `json:&quot;ret,omitempty&quot;`</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        Data</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">RetData</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `json:&quot;data,omitempty&quot;`</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        Msg</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  string</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   `json:&quot;msg&quot;`</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    resp</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> :=</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> &amp;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PdfResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        Ret</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ï¸</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        Msg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;success&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        Data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">RetData</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{},</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">JSON</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">StatusOK</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">resp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    //result:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    //{&quot;data&quot;:null,&quot;msg&quot;:&quot;success&quot;}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="replaceçš„ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#replaceçš„ä½¿ç”¨"><span>replaceçš„ä½¿ç”¨</span></a></h3><ul><li>åœºæ™¯ï¼š å¤šä¸ªé¡¹ç›®åŒ…ï¼Œæœ¬åœ°å¼•ç”¨</li><li>æè¿°ï¼š å¦‚æœå½“å‰é¡¹ç›®ä½¿ç”¨äº†å…¶ä»–gitlabçš„é¡¹ç›®,å¯ä»¥å°†å…¶ä¸‹è½½åˆ°æœ¬åœ°å¹¶ä½¿ç”¨replaceè¿›è¡Œæ›¿æ¢</li><li>replaceæ›¿æ¢æ”¯æŒç›¸å¯¹è·¯å¾„</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>  go.modï¼š </span></span>
<span class="line"><span>  replace gitlab.intsig.net/cs-server2/services/cs_proto =&gt; ../cs_proto</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="protoc-go-inject-tagå·¥å…·ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#protoc-go-inject-tagå·¥å…·ä½¿ç”¨"><span>protoc-go-inject-tagå·¥å…·ä½¿ç”¨</span></a></h3><ul><li>åœºæ™¯ï¼šprotoc-gen-go ç”Ÿæˆproto.go</li><li>æè¿°ï¼šè§£å†³ä½¿ç”¨protobufæ—¶ï¼Œå› ä¸ºæ²¡æœ‰è‡ªåŠ¨ç”Ÿæˆform tagå¯¼è‡´gin shouldbindqueryç­‰æ— æ³•ç»‘å®š</li><li>è¡¥å……ï¼šä½¿ç”¨inject-tagçš„å¼Šç«¯ï¼šç”Ÿæˆproto.goæ–‡ä»¶åéœ€è¦å†æ‰§è¡Œä¸€æ¬¡ï¼Œåœ¨åŸæ¥çš„proto.goä¸­æ–°å¢form tag</li><li>å‘½ä»¤è¡Œï¼š<code>protoc-go-inject-tag -input= xx.pb.go</code></li><li>æ¡ˆä¾‹è¯´æ˜ï¼š</li><li><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  //file: xx.proto</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  message</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> Html2PdfRequest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      string</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> url</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//æ‰‹åŠ¨æ·»åŠ tag @gotags: form:&quot;url&quot; json:&quot;url&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">xx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pb</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">go</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> æœªä½¿ç”¨inject</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">-</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tag</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Html2PdfRequest</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      state</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">         protoimpl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">MessageState</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      sizeCache</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">     protoimpl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">SizeCache</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      unknownFields</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> protoimpl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">UnknownFields</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      Url</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> string</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `protobuf:&quot;bytes,1,opt,name=url,proto3&quot; json:&quot;url&quot; `</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  //file: xx.pb.go ä½¿ç”¨inject-tag:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Html2PdfRequest</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      state</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">         protoimpl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">MessageState</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      sizeCache</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">     protoimpl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">SizeCache</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      unknownFields</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> protoimpl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">UnknownFields</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      Url</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> string</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> `protobuf:&quot;bytes,1,opt,name=url,proto3&quot; json:&quot;url&quot; `</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> //@gotags: form:&quot;url&quot; json:&quot;url&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="go-initå‡½æ•°å’Œmainå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#go-initå‡½æ•°å’Œmainå‡½æ•°"><span>go initå‡½æ•°å’Œmainå‡½æ•°</span></a></h3><ul><li>åœºæ™¯ï¼šapp æ¨¡å—åœ¨åŒ…å¼•å…¥æ—¶å³è¿›è¡Œappå˜é‡åˆå§‹åŒ–ä»¥åŠinitè°ƒç”¨</li><li>ä½œç”¨ï¼šåœ¨å¯åŠ¨ç¨‹åºæ—¶åˆå§‹åŒ–ï¼Œå¹¶ä¸”å®ç°sync.Onceçš„ä½œç”¨ï¼Œä»è€Œåœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨appå˜é‡æ—¶ï¼Œä½¿ç”¨çš„æ˜¯åŒä¸€ä»½å·²åˆå§‹åŒ–çš„æ•°æ®</li><li>åˆå§‹åŒ–é¡ºåºï¼š <ul><li><ol><li>å˜é‡åˆå§‹åŒ–-&gt;init()-&gt;main()</li></ol></li><li><ol start="2"><li>åˆå§‹åŒ–å¯¼å…¥çš„åŒ…: runtimeè§£æåŒ…ä¾èµ–å…³ç³»ï¼Œæ²¡æœ‰ä¾èµ–çš„åŒ…æœ€å…ˆåˆå§‹åŒ–</li></ol></li><li><ol start="3"><li>åˆå§‹åŒ–åŒ…ä½œç”¨åŸŸå˜é‡: runtimeè§£æå˜é‡ä¾èµ–å…³ç³»ï¼Œæ²¡æœ‰ä¾èµ–çš„å˜é‡æœ€å…ˆåˆå§‹åŒ–</li></ol></li></ul></li><li>ä¸¾ä¾‹ï¼š<div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// app.go</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> init</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    AppCtx</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> newApp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å…¨å±€app</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> App</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> struct</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    //é…ç½®AppCtx</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    cfg</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Config</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ServiceRegister</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Register</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    DaoRegister</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">     *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">dao</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Register</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    BisRegister</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">     *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">bis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Register</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> newApp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">App</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> &amp;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">App</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// åˆå§‹åŒ–æœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">app </span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">*</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">App</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">InitApp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cfg</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">sw</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">go2sky</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Tracer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) { ... }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">//main.go</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;gitlab.intsig.net/cs-server2/services/app_sync/app&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">app</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">AppCtx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">InitApp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cfg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tracer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="åŒ…ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#åŒ…ç®¡ç†"><span>åŒ…ç®¡ç†</span></a></h3><ul><li><p>èƒŒæ™¯ï¼šè¦æƒ³å†™å¥½goä»£ç ï¼Œè¦ä¸æ–­ç†è§£åŒ…å’ŒåŸºäºåŒ…å¤šå®è·µ</p></li><li><p>å°½é‡æŠŠç±»å‹å£°æ˜(struct)åœ¨è¢«ä½¿ç”¨çš„æ–‡ä»¶ä¸­</p></li><li><p>æŒ‰ç…§ä¸šåŠ¡é€»è¾‘å±‚(é€šç”¨åˆ†å±‚)ã€æŒ‰ç…§åŠŸèƒ½èŒè´£ï¼ˆä¸šåŠ¡åˆ†å±‚ï¼‰è¿›è¡ŒåŒ…çš„è®¾è®¡</p></li><li><div class="language-go line-numbers-mode" data-highlighter="shiki" data-ext="go" data-title="go" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  paper</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">-</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">examples</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupevent</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”œâ”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cmd</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚   â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">eventtimer</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚       â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">update</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚       â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">go</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚   â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">eventserver</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚       â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">router</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚           â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">handler</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚           â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">router</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">go</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚       â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tests</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚       â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">go</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”œâ”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">internal</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚   â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">eventserver</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚       â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">biz</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚           â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">event</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚           â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">member</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚       â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚           â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">service</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚   â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">eventpopdserver</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚       â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">event</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚       â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">member</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚   â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pkg</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚       â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cfg</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚       â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">db</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚       â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">vendor</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚   â”œâ”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">github</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">com</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚   â”‚   â”œâ”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ardanlabs</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚   â”‚   â”œâ”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">golang</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚   â”‚   â”œâ”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">prometheus</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”‚   â””â”€â”€ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">golang</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">org</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">/</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”œâ”€â”€ </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">go</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">mod</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â”œâ”€â”€ </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">go</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sum</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>cmd/: é¡¹ç›®ä¸­çš„æ‰€æœ‰ä½ å°†è¦ç¼–è¯‘æˆå¯æ‰§è¡Œç¨‹åºçš„å…¥å£ä»£ç éƒ½æ”¾åœ¨cmd/ æ–‡ä»¶å¤¹é‡Œï¼Œè¿™äº›ä»£ç å’Œä¸šåŠ¡æ²¡æœ‰å…³ç³»</p></li><li><p>internal/: åœ¨é¡¹ç›®ä¸­ä¸è¢«å¤ç”¨ï¼Œä¹Ÿä¸èƒ½è¢«å…¶ä»–é¡¹ç›®å¯¼å…¥ï¼Œä»…è¢«æœ¬é¡¹ç›®å†…éƒ¨ä½¿ç”¨çš„ä»£ç åŒ…å³ç§æœ‰çš„ä»£ç åŒ…éƒ½åº”è¯¥æ”¾åœ¨internalæ–‡ä»¶å¤¹ä¸‹.</p></li><li><p>internalåŒ…çš„å¯¼å…¥è§„åˆ™æ˜¯</p></li><li><p>pkg/: å…¶ä»–é¡¹ç›®æ˜¯å¯ä»¥ç›´æ¥å¯¼å…¥</p></li><li><p>vendor/: åŒ…å«äº†æ‰€æœ‰ä¾èµ–çš„ä¸‰æ–¹çš„æºä»£ç ã€‚æ—©æœŸç‰ˆæœ¬ä½¿ç”¨ï¼Œç›®å‰å·²è¢«modulesæ›¿ä»£ã€‚</p></li><li><p>kit/ï¼š è¢«ä¸åŒåº”ç”¨é¡¹ç›®å¯¼å…¥çš„åŸºç¡€åŒ…</p></li><li></li></ul><h3 id="structã€map-å¦‚ä½•é€‰æ‹©" tabindex="-1"><a class="header-anchor" href="#structã€map-å¦‚ä½•é€‰æ‹©"><span>structã€map å¦‚ä½•é€‰æ‹©</span></a></h3><ul><li>structï¼Œå°±æ˜¯ä½ çŸ¥é“keyæœ‰å“ªäº›å’Œå¯¹åº”çš„æ•°æ®ç±»å‹</li><li>mapï¼Œå°±æ˜¯ä½ ä¸èƒ½ç¡®å®škeyæœ‰å“ªäº›</li><li>ç»“æ„ä½“è§£æå·²çŸ¥ç»“æ„çš„json</li><li>jsonè§£æåˆ°map[string]interface{}</li></ul><h3 id="range-å‰¯æœ¬é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#range-å‰¯æœ¬é—®é¢˜"><span>range å‰¯æœ¬é—®é¢˜</span></a></h3><ul><li>ä½¿ç”¨rangeæ—¶ï¼Œå¦‚ä½•åˆ¤æ–­æ˜¯å¦å‰¯æœ¬ï¼Ÿ</li><li>rangeéå†æ—¶valueæ˜¯å€¼çš„æ‹·è´ï¼Œæ‰€ä»¥é€šè¿‡valueä¿®æ”¹å€¼ä¸ä¼šç”Ÿæ•ˆ <ul><li>è§£å†³æ–¹æ³•ï¼š</li><li><ol><li>éå†çš„å¯¹è±¡ä¸­çš„valueè°ƒæ•´ä¸ºæŒ‡é’ˆç±»å‹ï¼Œé€šè¿‡æŒ‡é’ˆä¿®æ”¹</li></ol></li><li><ol start="2"><li>é€šè¿‡éå†å¯¹è±¡ä¸­çš„keyè¿›è¡Œä¿®æ”¹valueå€¼</li></ol></li></ul></li></ul><h3 id="io-readall-io-copyçš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#io-readall-io-copyçš„åŒºåˆ«"><span>io.ReadAllï¼Œio.Copyçš„åŒºåˆ«</span></a></h3><ul><li>io.ReadAll buffer sizeåˆå§‹å€¼512ï¼ŒåŸºäºsliceåŠ¨æ€æ‰©å®¹ã€‚å°äº512æ—¶ï¼Œæ€§èƒ½é—®é¢˜ä¸å¤§ã€‚åªå®Œæˆæ•°æ®è¯»å‡ºã€‚åªèƒ½ç”¨äºæ•°æ®å…¨éƒ¨è¯»å‡ºæ¥çš„åœºæ™¯ã€‚</li><li>io.Copy buffer sizeå›ºå®šä¸º32kbï¼Œæ€§èƒ½å¥½ã€‚å®Œæˆäº†è¯»å‡º + å†™å…¥Writerã€‚é€‚ç”¨äºè¾¹è¯»è¾¹å†™çš„å¤§æ•°æ®åœºæ™¯ã€‚</li><li>å¦‚æœè¯»å–å‡ºæ¥çš„æ•°æ®ï¼Œæ˜¯è¦ç”¨jsonå†è§£ç åˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ json.NewDecoder(reader).Decode(&amp;v)ï¼Œç›´æ¥ä½¿ç”¨readerï¼Œæ— éœ€buffer</li></ul><h3 id="vscode-goè·³è½¬é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#vscode-goè·³è½¬é—®é¢˜"><span>vscode goè·³è½¬é—®é¢˜</span></a></h3><p><a href="https://juejin.cn/s/vscode%20golang%20%E8%B7%B3%E8%BD%AC%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener noreferrer">è§£å†³æ–¹æ¡ˆ</a></p><h3 id="map-string-struct-çš„èµ‹å€¼é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#map-string-struct-çš„èµ‹å€¼é—®é¢˜"><span>map[string]struct{}çš„èµ‹å€¼é—®é¢˜</span></a></h3><ul><li>struct{}åº”å½“ä½œä¸ºæ•´ä½“ï¼Œå±äºä¸€ä¸ªç±»å‹</li><li>å…¶æœ¬è´¨å±äºåŒ¿åç»“æ„ä½“ç±»å‹ä»¥åŠèµ‹å€¼æ“ä½œ</li><li>å…·ä½“ä¾‹å­ï¼š</li><li><div class="language-golang line-numbers-mode" data-highlighter="shiki" data-ext="golang" data-title="golang" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>  s=make(map[string]struct{})</span></span>
<span class="line"><span>  s[&quot;1&quot;]=struct{}{}       //ç¬¬ä¸€ä¸ª{}è·Ÿéšstructæ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œç¬¬äºŒä¸ªæ˜¯å…·ä½“å€¼ï¼Œå› ä¸ºæœ¬èº«æ˜¯ç©ºç»“æ„ä½“ï¼Œæ‰€ä»¥å€¼ä¸º{}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li>ä¸€ä¸ªå¸¦æˆå‘˜çš„åŒ¿åstructèµ‹å€¼ï¼š</li><li><div class="language-golang line-numbers-mode" data-highlighter="shiki" data-ext="golang" data-title="golang" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>  b := make(map[string]*struct{ C int })</span></span>
<span class="line"><span>  b[&quot;s&quot;] = &amp;struct{C int}{</span></span>
<span class="line"><span>      C: 1,</span></span>
<span class="line"><span>  }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li>å…¶ä»–åŒ¿åç±»å‹ï¼šç»“æ„ä½“åŒ¿åå­—æ®µã€åŒ¿åå‡½æ•°/é—­åŒ…å‡½æ•°</li></ul><h3 id="æ£€æµ‹ç±»å‹æ˜¯å¦å®ç°äº†æ¥å£-var-io-writer-mywriter-nil" tabindex="-1"><a class="header-anchor" href="#æ£€æµ‹ç±»å‹æ˜¯å¦å®ç°äº†æ¥å£-var-io-writer-mywriter-nil"><span>æ£€æµ‹ç±»å‹æ˜¯å¦å®ç°äº†æ¥å£ var _ io.Writer = (*myWriter)(nil)</span></a></h3><ul><li>èµ‹å€¼è¯­å¥å¯èƒ½ä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ï¼Œåœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨ä¼šæ£€æµ‹ç­‰å·å³è¾¹çš„ç±»å‹æ˜¯å¦å®ç°äº†ç­‰å·å·¦è¾¹æ¥å£æ‰€è§„å®šçš„å‡½æ•°</li><li><div class="language-golang line-numbers-mode" data-highlighter="shiki" data-ext="golang" data-title="golang" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>  type myWriter struct {</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  /*func (w myWriter) Write(p []byte) (n int, err error) {</span></span>
<span class="line"><span>      return</span></span>
<span class="line"><span>  }*/</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  func main() {</span></span>
<span class="line"><span>      // æ£€æŸ¥ *myWriter ç±»å‹æ˜¯å¦å®ç°äº† io.Writer æ¥å£</span></span>
<span class="line"><span>      var _ io.Writer = (*myWriter)(nil)   //ç¼–è¯‘å™¨ä¼šå¸®å¿™å®ç°æŒ‡é’ˆæ¥æ”¶è€…çš„æ–¹æ³•func (w *myWriter) Write</span></span>
<span class="line"><span></span></span>
<span class="line"><span>      // æ£€æŸ¥ myWriter ç±»å‹æ˜¯å¦å®ç°äº† io.Writer æ¥å£</span></span>
<span class="line"><span>      var _ io.Writer = myWriter{}//è§£é‡Šä¸‹ï¼šæŠŠmyWriterç»“æ„ä½“å¯¹è±¡ç»‘å®šåˆ°io.Writeræ¥å£ç±»å‹çš„åŠ¨æ€å€¼ä¸Š</span></span>
<span class="line"><span>  }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="newå’Œmake" tabindex="-1"><a class="header-anchor" href="#newå’Œmake"><span>newå’Œmake</span></a></h3><ul><li>new å‡½æ•°ï¼š <ul><li>func new(Type) *Type</li><li>new è¿”å›ç±»å‹Typeçš„æŒ‡é’ˆ *Typeï¼Œæ˜¯é›¶å€¼æŒ‡é’ˆ</li><li>new ä»…ä»…åˆ†é…ç©ºé—´</li><li><div class="language-golang line-numbers-mode" data-highlighter="shiki" data-ext="golang" data-title="golang" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>//ä¸¾ä¾‹ï¼š</span></span>
<span class="line"><span>type Student struct{}</span></span>
<span class="line"><span>var i interface{} = new(Student) //ç­‰ä»·äºï¼š</span></span>
<span class="line"><span>var i interface{} = (*Student)(nil)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li>make å‡½æ•°ï¼š <ul><li>func make(Type, size IntegerType) Type</li><li>make è¿”å›ç±»å‹Type</li><li>make åˆ†é…ç©ºé—´ + åˆå§‹åŒ–</li><li>make åªèƒ½ ç”¨äºsliceã€mapã€chan å¯¹è±¡çš„åˆå§‹åŒ–</li><li>make å› ä¸ºé™å®šåªèƒ½å¯¹Typeä¸º sliceã€mapã€chanåˆå§‹åŒ–ï¼Œæ‰€ä»¥è¿”å›çš„ç±»å‹ä¸€å®šæ˜¯å¼•ç”¨ç±»å‹</li></ul></li></ul><h3 id="æ ˆä¸­åˆ†é…çš„å˜é‡-å‡ºæ ˆçš„æ—¶å€™ä¸ä¼šè¢«é‡Šæ”¾å—" tabindex="-1"><a class="header-anchor" href="#æ ˆä¸­åˆ†é…çš„å˜é‡-å‡ºæ ˆçš„æ—¶å€™ä¸ä¼šè¢«é‡Šæ”¾å—"><span>æ ˆä¸­åˆ†é…çš„å˜é‡ï¼Œå‡ºæ ˆçš„æ—¶å€™ä¸ä¼šè¢«é‡Šæ”¾å—</span></a></h3><pre><code>* ```golang
    func newInt *int {
        var i int
        return &amp;i     //ä¸ºä½•å¯ä»¥è¿”å›å±€éƒ¨å˜é‡å‘¢ï¼Ÿ
    }

    someInt := newInt()
  ```
</code></pre><h3 id="é€ƒé€¸åˆ†æ" tabindex="-1"><a class="header-anchor" href="#é€ƒé€¸åˆ†æ"><span>é€ƒé€¸åˆ†æ</span></a></h3><ul><li>æœ¬è´¨ï¼šç¼–è¯‘å™¨å¸®ç¨‹åºå‘˜å†³å®šå˜é‡çš„åˆ†é…ä½ç½®ï¼ŒæŠŠå˜é‡åˆç†åœ°åˆ†é…åˆ°å®ƒè¯¥å»çš„åœ°æ–¹ï¼ˆå †/æ ˆï¼‰</li><li><blockquote><ol><li>å¦‚æœå‡½æ•°å¤–éƒ¨æ²¡æœ‰å¼•ç”¨ï¼Œåˆ™ä¼˜å…ˆæ”¾åˆ°æ ˆä¸­ï¼›</li><li>å¦‚æœå‡½æ•°å¤–éƒ¨å­˜åœ¨å¼•ç”¨ï¼Œåˆ™å¿…å®šæ”¾åˆ°å †ä¸­ï¼›</li></ol></blockquote></li><li>å †æ ˆçš„å¯¹æ¯”ï¼š <ul><li>å †é€‚åˆä¸å¯é¢„çŸ¥å¤§å°çš„å†…å­˜åˆ†é…</li><li>å †åˆ†é…é€Ÿåº¦è¾ƒæ…¢</li><li>é¢‘ç¹å †åˆ†é…ä¼šå½¢æˆå†…å­˜ç¢ç‰‡</li><li>å †éœ€å‹è¿«é€šè¿‡åƒåœ¾å›æ”¶ï¼ˆgcï¼‰æ‰èƒ½é‡Šæ”¾ï¼Œè€—cpuï¼›æ ˆå¯ä»¥è‡ªåŠ¨æ¸…ç†</li></ul></li><li><div class="language-golang line-numbers-mode" data-highlighter="shiki" data-ext="golang" data-title="golang" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>  package main</span></span>
<span class="line"><span>  type S struct {}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  func main() {</span></span>
<span class="line"><span>      var x S</span></span>
<span class="line"><span>      /*</span></span>
<span class="line"><span>        zæ˜¯å¯¹xçš„æ‹·è´ï¼Œrefå‡½æ•°ä¸­å¯¹zå–äº†å¼•ç”¨ï¼Œæ‰€ä»¥zä¸èƒ½æ”¾åœ¨æ ˆä¸Šå¿…é¡»è¦é€ƒé€¸åˆ°å †ä¸Šï¼Œå¦åˆ™åœ¨refå‡½æ•°ä¹‹å¤–ï¼Œæ— æ³•é€šè¿‡å¼•ç”¨æ‰¾åˆ°zã€‚</span></span>
<span class="line"><span>        ä»…ç®¡åœ¨mainå‡½æ•°ä¸­ï¼Œç›´æ¥ä¸¢å¼ƒäº†refçš„ç»“æœï¼Œå¤–éƒ¨æ²¡æœ‰ä½¿ç”¨åˆ°å¼•ç”¨ï¼Œä½†æ˜¯Goçš„ç¼–è¯‘å™¨è¿˜æ²¡æœ‰é‚£ä¹ˆæ™ºèƒ½ï¼Œåˆ†æä¸å‡ºæ¥è¿™ç§æƒ…å†µã€‚</span></span>
<span class="line"><span>      */</span></span>
<span class="line"><span>      _ = *ref(x)</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  func ref(z S) *S {</span></span>
<span class="line"><span>      return &amp;z</span></span>
<span class="line"><span>  }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="goç¼–è¯‘è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#goç¼–è¯‘è¿‡ç¨‹"><span>goç¼–è¯‘è¿‡ç¨‹</span></a></h3><p>ä»æºæ–‡ä»¶åˆ°å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶çš„è½¬åŒ–è¿‡ç¨‹ï¼š <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/b290f1ee1f29670d608c425edfec2d96.png" alt="compile" loading="lazy"></p><h3 id="goç¼–è¯‘å™¨ä¼˜åŒ–å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#goç¼–è¯‘å™¨ä¼˜åŒ–å‡½æ•°"><span>goç¼–è¯‘å™¨ä¼˜åŒ–å‡½æ•°</span></a></h3><figure><img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/85ada42f30bc8039720da3c7c03a1bbd.png" alt="Img" tabindex="0" loading="lazy"><figcaption>Img</figcaption></figure><h3 id="gcæœºåˆ¶-å¯¹å †ä¸Šçš„å¯¹è±¡çš„æ¸…ç†" tabindex="-1"><a class="header-anchor" href="#gcæœºåˆ¶-å¯¹å †ä¸Šçš„å¯¹è±¡çš„æ¸…ç†"><span>GCæœºåˆ¶ï¼ˆå¯¹å †ä¸Šçš„å¯¹è±¡çš„æ¸…ç†ï¼‰</span></a></h3><ul><li>GCç®—æ³•åˆ†ç±»ï¼š <ol><li>è¿½è¸ªå¼ï¼ˆä»æ ¹å¼€å§‹ï¼Œæ ¹æ®å¼•ç”¨å…³ç³»ï¼Œå®Œæ•´æ‰«ææ•´ä¸ªå †ï¼‰ <ol><li>æ ‡è®°æ¸…æ‰«ï¼š <ul><li>æ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œæ¸…æ‰«å¯å›æ”¶å¯¹è±¡</li></ul></li><li>æ ‡è®°æ•´ç†ï¼š <ul><li>åœ¨æ ‡è®°æ¸…æ‰«åŸºç¡€ä¸Šï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œå°†å¯¹è±¡å°½å¯èƒ½æ”¾åœ¨è¿ç»­å†…å­˜ä¸Š</li></ul></li><li>å¢é‡å¼ï¼š <ul><li>åœ¨æ ‡è®°æ¸…æ‰«åŸºç¡€ä¸Šï¼Œå°†æ•´ä¸ªè¿‡ç¨‹åˆ†æ‰¹æ‰§è¡Œï¼Œå·²è¾¾åˆ°å¿«é€Ÿã€å®æ—¶ç›®çš„</li></ul></li><li>å¢é‡æ•´ç†ï¼š <ul><li>åœ¨å¢é‡å¼åŸºç¡€ä¸Šï¼Œæ·»åŠ å¯¹å¯¹è±¡çš„å†…å­˜æ•´ç†</li></ul></li><li>åˆ†ä»£å¼ï¼š <ul><li>å°†å¯¹è±¡æ ¹æ®å­˜æ´»æ—¶é—´çš„é•¿çŸ­è¿›è¡Œåˆ†ç±»ï¼Œæ ¹æ®åˆ†ä»£å‡è®¾å¯¹<strong>å¹´è½»ä»£</strong>å¯¹è±¡è¿›è¡Œå›æ”¶</li><li>åˆ†ä»£å‡è®¾ï¼š <ul><li>å¦‚æœä¸€ä¸ªå¯¹è±¡å­˜æ´»æ—¶é—´ä¸é•¿åˆ™å€¾å‘äºè¢«å›æ”¶</li><li>å¦‚æœä¸€ä¸ªå¯¹è±¡å·²ç»å­˜æ´»å¾ˆé•¿æ—¶é—´åˆ™å€¾å‘äºå­˜æ´»æ›´é•¿æ—¶é—´</li></ul></li><li>ä»€ä¹ˆæ˜¯åˆ†ä»£ï¼šç±»ä¼¼äº70åã€80åã€90å <ul><li>æ–°ç”Ÿä»£ï¼šå­˜æ´»æ—¶é—´å°äºæŸä¸ªå€¼</li><li>è€å¹´ä»£ï¼šå­˜æ´»æ—¶é—´å¤§äºæŸä¸ªå€¼</li><li>æ°¸ä¹…ä»£ï¼šæ°¸ä¹…ä¸åˆ é™¤çš„å¯¹è±¡</li></ul></li></ul></li></ol></li><li>å¼•ç”¨è®¡æ•°ï¼ˆæ¯ä¸ªå¯¹è±¡è‡ªèº«åŒ…å«ä¸€ä¸ªè¢«å¼•ç”¨çš„è®¡æ•°å™¨ï¼Œè®¡æ•°å™¨å½’é›¶è‡ªåŠ¨æ¸…ç†ï¼Œå­˜åœ¨ç¼ºé™·ï¼Œæ€§èƒ½è¾ƒä½ï¼‰</li></ol></li><li>æ ¹å¯¹è±¡ã€æ ¹é›†åˆçš„å«ä¹‰ï¼š <ul><li>å®ƒæ˜¯åƒåœ¾å›æ”¶å™¨åœ¨æ ‡è®°è¿‡ç¨‹æ—¶æœ€å…ˆæ£€æŸ¥çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ï¼š <ol><li>å…¨å±€å˜é‡ï¼šç¨‹åºåœ¨ç¼–è¯‘æœŸå°±èƒ½ç¡®å®šçš„é‚£äº›å­˜åœ¨äºç¨‹åºæ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„å˜é‡ã€‚</li><li>goroutine æ‰§è¡Œæ ˆï¼šæ¯ä¸ª goroutine éƒ½åŒ…å«è‡ªå·±çš„æ‰§è¡Œæ ˆï¼Œè¿™äº›æ‰§è¡Œæ ˆä¸ŠåŒ…å«æ ˆä¸Šçš„å˜é‡åŠæŒ‡å‘åˆ†é…çš„goroutine</li><li>å¯„å­˜å™¨ï¼šå¯„å­˜å™¨çš„å€¼å¯èƒ½è¡¨ç¤ºä¸€ä¸ªæŒ‡é’ˆï¼Œå‚ä¸è®¡ç®—çš„è¿™äº›æŒ‡é’ˆå¯èƒ½æŒ‡å‘æŸäº›èµ‹å€¼å™¨åˆ†é…çš„å †å†…å­˜åŒºå—ã€‚</li></ol></li></ul></li><li>Goçš„GCç›¸å…³æ¦‚å¿µï¼š <ul><li>ä¸‰è‰²æ ‡è®°æ¸…æ‰«æ³•ï¼ˆå±äºè¿½è¸ªå¼ä¸­çš„æ ‡è®°æ¸…æ‰«ï¼Œæ— åˆ†ä»£ï¼Œæ— æ•´ç†ï¼‰ <ul><li>ä¸æ•´ç†çš„åŸå› ï¼š <ul><li>goä½¿ç”¨tcmallocï¼ŒåŸºæœ¬æ²¡æœ‰å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œå°±ç®—ä½¿ç”¨æ•´ç†æ”¶ç›Šä¸é«˜</li><li>é¡ºåºå†…å­˜åˆ†é…å™¨åœ¨goçš„å¤šçº¿ç¨‹åœºæ™¯ä¸‹å¹¶ä¸é€‚ç”¨</li></ul></li><li>ä¸åˆ†ä»£çš„åŸå› ï¼š <ul><li>goç¼–è¯‘å™¨æœ‰å†…å­˜é€ƒé€¸åˆ†æï¼Œå¯ä»¥å°†å¤§éƒ¨ä»½å¹´è½»ä»£å¯¹è±¡å­˜æ”¾åœ¨æ ˆä¸Šï¼Œä»è€Œå®ç°è‡ªåŠ¨å›æ”¶ï¼Œå¹¶ä¸éœ€è¦é€šè¿‡gcï¼›é‚£äº›éœ€è¦é•¿æœŸå­˜åœ¨çš„å¯¹è±¡æ‰ä¼šè¢«åˆ†é…åˆ°éœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶çš„å †ä¸­ã€‚(å³å †ä¸Šçš„å¯¹è±¡ä»£é™…ä¸æ˜æ˜¾ï¼ŒåŒºåˆ†åº¦ä¸é«˜)ã€‚</li><li>goçš„åƒåœ¾å›æ”¶å™¨ä¸ç”¨æˆ·ä»£ç å¹¶å‘æ‰§è¡Œï¼Œä½¿å¾—STWçš„æ—¶é—´ä¸å¯¹è±¡çš„ä»£é™…ã€å¯¹è±¡çš„ size æ²¡æœ‰å…³ç³»</li></ul></li></ul></li><li>ä¸‰è‰²æŠ½è±¡ï¼š <ul><li>ä¸€ç§æè¿°è¿½è¸ªå¼å›æ”¶å™¨çš„æ–¹æ³•ï¼Œå®ƒçš„é‡è¦ä½œç”¨åœ¨äºä»é€»è¾‘ä¸Šä¸¥å¯†æ¨å¯¼æ ‡è®°æ¸…ç†è¿™ç§åƒåœ¾å›æ”¶æ–¹æ³•çš„æ­£ç¡®æ€§</li><li>ä¸‰è‰²æŠ½è±¡è§„å®šçš„ä¸‰ç§å¯¹è±¡ï¼š <ul><li>ç™½è‰²å¯¹è±¡ï¼ˆå¯èƒ½æ­»äº¡ï¼‰ï¼š <ul><li>æœªè¢«å›æ”¶å™¨è®¿é—®åˆ°çš„å¯¹è±¡ã€‚</li><li>åœ¨å›æ”¶å¼€å§‹é˜¶æ®µï¼Œæ‰€æœ‰å¯¹è±¡å‡ä¸ºç™½è‰²ï¼Œå½“å›æ”¶ç»“æŸåï¼Œç™½è‰²å¯¹è±¡å‡ä¸å¯è¾¾ã€‚</li></ul></li><li>ç°è‰²å¯¹è±¡ï¼ˆæ³¢é¢ï¼‰ï¼š <ul><li>æ­£åœ¨è¢«å›æ”¶å™¨è®¿é—®åˆ°çš„å¯¹è±¡ã€‚</li><li>å›æ”¶å™¨éœ€è¦å¯¹å…¶ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡é’ˆè¿›è¡Œæ‰«æï¼Œå› ä¸ºä»–ä»¬å¯èƒ½è¿˜æŒ‡å‘ç™½è‰²å¯¹è±¡ã€‚</li></ul></li><li>é»‘è‰²å¯¹è±¡ï¼ˆç¡®å®šå­˜æ´»ï¼‰ï¼š <ul><li>å·²è¢«å›æ”¶å™¨è®¿é—®åˆ°çš„å¯¹è±¡ï¼Œ</li><li>å…¶ä¸­æ‰€æœ‰å­—æ®µéƒ½å·²è¢«æ‰«æï¼Œé»‘è‰²å¯¹è±¡ä¸­ä»»ä½•ä¸€ä¸ªæŒ‡é’ˆéƒ½ä¸å¯èƒ½ç›´æ¥æŒ‡å‘ç™½è‰²å¯¹è±¡ã€‚</li></ul></li></ul></li></ul></li><li>æ³¢é¢æ¨è¿›ï¼š <ul><li>å¯¹ä¸‰è‰²å¯¹è±¡çš„å›æ”¶è¿‡ç¨‹å…¶å®æ˜¯ä¸€ä¸ª<strong>æ³¢é¢</strong>ä¸æ–­å‰è¿›çš„è¿‡ç¨‹ã€‚è¿™ä¸ªæ³¢é¢åŒæ—¶ä¹Ÿæ˜¯é»‘è‰²å¯¹è±¡å’Œç™½è‰²å¯¹è±¡çš„è¾¹ç•Œï¼Œç°è‰²å¯¹è±¡å°±æ˜¯è¿™ä¸ªæ³¢é¢ã€‚</li><li>ä»¥ç°è‰²å¯¹è±¡ä¸ºæ³¢é¢ï¼Œå°†é»‘è‰²å¯¹è±¡å’Œç™½è‰²å¯¹è±¡åˆ†ç¦»ï¼Œä½¿æ³¢é¢ä¸æ–­å‘å‰æ¨è¿›ï¼Œç›´åˆ°æ‰€æœ‰å¯è¾¾çš„ç°è‰²å¯¹è±¡éƒ½å˜ä¸ºé»‘è‰²å¯¹è±¡ä¸ºæ­¢çš„è¿‡ç¨‹ã€‚ <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/53c95ad4fd4efeab51fee825eec022ba.png" alt="Img" loading="lazy"></li></ul></li><li>STWï¼š <ul><li><code>Stop the World</code> or <code>Start the World</code></li><li>STWåœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼š <ul><li>ç›®çš„ï¼šä¸ºäº†ä¿è¯å®ç°çš„æ­£ç¡®æ€§ã€é˜²æ­¢æ— æ­¢å¢ƒçš„å†…å­˜å¢é•¿ç­‰é—®é¢˜</li><li>æ‰‹æ®µï¼šåœæ­¢èµ‹å€¼å™¨è¿›ä¸€æ­¥æ“ä½œå¯¹è±¡å›¾ï¼Œå³ä¸å…è®¸èµ‹å€¼å™¨ä¿®æ”¹å¯¹è±¡çš„å¼•ç”¨å…³ç³»</li><li>å½±å“ï¼šåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ•´ä¸ªç”¨æˆ·ä»£ç è¢«åœæ­¢æˆ–è€…æ”¾ç¼“æ‰§è¡Œï¼Œå³goroutineä¼šè¢«æš‚åœæ‰§è¡Œç”¨æˆ·ä»£ç </li></ul></li><li>è¿­ä»£ä¼˜åŒ–ï¼š <ul><li>èƒŒæ™¯ï¼šGo1.14å‰ï¼Œforå¾ªç¯å†…çš„goroutineä¸ä¼šä¸­æ–­ï¼Œä»è€Œå§‹ç»ˆæ— æ³•è¿›å…¥ STW é˜¶æ®µã€‚å¯¼è‡´gcä¸€ç›´æ— æ³•è¿›è¡Œã€‚</li><li>ä¼˜åŒ–ï¼šæ·»åŠ goroutineçš„å¼‚æ­¥æŠ¢å ï¼Œä½¿è¿™ç±» goroutineèƒ½å¤Ÿè¢«å¼‚æ­¥åœ°æŠ¢å ï¼Œä½¿å¾—STW çš„æ—¶é—´ä¸ä¼šè¶…è¿‡æŠ¢å ä¿¡å·è§¦å‘çš„å‘¨æœŸ</li></ul></li></ul></li></ul></li><li><h2 id="goå¹¶å‘æ ‡è®°æ¸…é™¤" tabindex="-1"><a class="header-anchor" href="#goå¹¶å‘æ ‡è®°æ¸…é™¤"><span>Goå¹¶å‘æ ‡è®°æ¸…é™¤ï¼š</span></a></h2><ul><li><p>éš¾ç‚¹ï¼š<strong>ä¿è¯æ ‡è®°ä¸æ¸…é™¤è¿‡ç¨‹çš„æ­£ç¡®æ€§</strong></p><ul><li>æ­£ç¡®æ€§çš„å«ä¹‰ï¼š <ul><li>ä¸åº”å‡ºç°å¯¹è±¡çš„ä¸¢å¤±</li><li>ä¸åº”é”™è¯¯çš„å›æ”¶è¿˜ä¸éœ€è¦å›æ”¶çš„å¯¹è±¡</li></ul></li><li>ä¸æ­£ç¡®ä¾‹å­ï¼š<img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/826ab9aff0dd5f0077ccdeef32bbd96f.png" alt="Img" loading="lazy"> å½“Aæˆä¸ºæ³¢é¢æ—¶ï¼Œåˆè¢«Cå¼•ç”¨äº†ï¼Œä»è€Œå¯¼è‡´Bæ²¡æœ‰è¢«æ‰«æåˆ°ï¼Œæœ€ç»ˆBè¢«é”™è¯¯å›æ”¶</li></ul></li><li><p>å¦‚ä½•ç ´åæ­£ç¡®æ€§ï¼š<strong>åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶</strong>ï¼š</p><ul><li><code>æ¡ä»¶1</code>: èµ‹å€¼å™¨ä¿®æ”¹å¯¹è±¡å›¾ï¼Œå¯¼è‡´<strong>æŸä¸€é»‘è‰²å¯¹è±¡å¼•ç”¨ç™½è‰²å¯¹è±¡</strong>ï¼›</li><li><code>æ¡ä»¶2</code>: ä»ç°è‰²å¯¹è±¡å‡ºå‘ï¼Œç™½è‰²å¯¹è±¡å°šæœªè¢«è®¿é—®ï¼Œè€Œ<strong>è®¿é—®è·¯å¾„è¢«èµ‹å€¼å™¨ç ´å</strong>ï¼›</li></ul><ul><li>ç»“åˆä¸Šå›¾è¿›è¡Œè§£é‡Šï¼šCå¼•ç”¨äº†Bå¹¶ä¸”ï¼ŒAåˆ°Bçš„è·¯å¾„å°šæœªè¢«è®¿é—®åˆ°ã€‚å³ç™½è‰²å¯¹è±¡å†ä¹Ÿæ— æ³•ä»æ³¢é¢å¤„è®¿é—®ï¼Œä½†æ˜¯å´è¢«é»‘è‰²å¯¹è±¡åˆå¼•ç”¨äº†ã€‚</li></ul></li><li><p>é¿å…ç ´åæ­£ç¡®æ€§ï¼š<strong>é¿å…ä»»ä¸€ç ´ç¯æ­£ç¡®æ€§çš„æ¡ä»¶</strong></p><ul><li>é¿å…<code>æ¡ä»¶1</code>æˆç«‹ï¼šç™½è‰²å¯¹è±¡åªè¢«ç°è‰²å¯¹è±¡å¼•ç”¨ï¼ˆé˜»æ–­é»‘è‰²å¯¹è±¡å¼•ç”¨ç™½è‰²ï¼‰</li><li>é¿å…<code>æ¡ä»¶2</code>æˆç«‹ï¼šç¡®ä¿ä»ç°è‰²å¯¹è±¡å‡ºå‘ï¼Œæ€»å­˜åœ¨ä¸€æ¡æ²¡æœ‰è®¿é—®è¿‡çš„è·¯å¾„èƒ½åˆ°è¾¾ç™½è‰²å¯¹è±¡ï¼ˆç¡®ä¿è®¿é—®è·¯å¾„å­˜åœ¨ï¼‰</li></ul></li><li><p>å¼ºå¼±ä¸å˜æ€§ï¼š</p><ul><li>å¼ºä¸‰è‰²ä¸å˜æ€§ï¼šåŒæ—¶é¿å…çš„ä¸¤ä¸ªæ¡ä»¶</li><li>å¼±ä¸‰è‰²ä¸å˜å½¢ï¼šåªæ»¡è¶³é¿å…æ¡ä»¶2ã€‚å³å­˜åœ¨è®¿é—®è·¯å¾„ï¼›å…è®¸é»‘è‰²å¼•ç”¨ç™½è‰²å¯¹è±¡</li></ul></li><li><p>å†™å±éšœï¼š</p><ul><li>æŒ‡èµ‹å€¼å™¨çš„å†™å±éšœï¼Œèµ‹å€¼å™¨çš„å†™å±éšœæ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶ï¼ˆé€šçŸ¥çš„æ–¹å¼ï¼‰</li><li>ç›®çš„ï¼šä½¿èµ‹å€¼å™¨åœ¨è¿›è¡ŒæŒ‡é’ˆå†™æ“ä½œæ—¶ï¼Œèƒ½å¤Ÿâ€œé€šçŸ¥â€å›æ”¶å™¨ï¼Œè¾¾åˆ°ä¸ä¼šç ´å<strong>å¼±ä¸‰è‰²ä¸å˜æ€§</strong>çš„ç›®çš„</li><li>æ—¶æœºï¼šæ‰€æœ‰å†™æ“ä½œï¼Œå³å»ºç«‹å¼•ç”¨å’Œè§£é™¤å¼•ç”¨æ—¶</li><li>å†™å±éšœç®—æ³•ï¼š <ul><li><p>Dijkstra æ’å…¥å±éšœï¼š</p><ul><li>é¿å…<code>æ¡ä»¶1</code>æˆç«‹ã€‚</li><li>å…·ä½“åšæ³•ï¼šä¸ºäº†é˜²æ­¢é»‘è‰²å¯¹è±¡æŒ‡å‘ç™½è‰²å¯¹è±¡ï¼ŒæŠŠå¯¹åº”çš„ç™½è‰²å¯¹è±¡å…ˆå˜æˆç°è‰²ï¼Œç„¶ååœ¨æ ‡è®°ç»ˆæ­¢é˜¶æ®µSTWæ—¶ï¼Œé‡æ–°æ‰«æè¿™äº›ç°è‰²å¯¹è±¡ã€‚</li><li>æ—¶æœºï¼šæ‰€æœ‰å†™æ“ä½œå‰</li><li>å¯¹è±¡ï¼šç€è‰²è¢«å¼•ç”¨è€… <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/7951eca316c22aebc3f3632a045a296d.png" alt="Img" loading="lazy"></li></ul></li><li><p>Yuasa åˆ é™¤å±éšœï¼š</p><ul><li>é¿å…<code>æ¡ä»¶2</code>æˆç«‹</li><li>å…·ä½“åšæ³•ï¼šä¸ºäº†é˜²æ­¢ä¸¢å¤±ä»ç°è‰²å¯¹è±¡åˆ°ç™½è‰²å¯¹è±¡çš„è·¯å¾„ï¼Œå°†å˜ä¸ºé»‘è‰²çš„å¯¹è±¡å†æ¬¡å˜æˆç°è‰²ï¼Œå³æ³¢é¢å‘ç”Ÿåé€€ã€‚</li><li>æ—¶æœºï¼šæ‰€æœ‰å†™æ“ä½œå</li><li>å¯¹è±¡ï¼šç€è‰²å¼•ç”¨è€… <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/ae454158ac349742cf7217c472eed8ba.png" alt="Img" loading="lazy"></li><li>ä¼˜ç¼ºç‚¹ï¼šä¸éœ€è¦æ ‡è®°ç»“æŸé˜¶æ®µçš„é‡æ–°æ‰«æã€‚ä½†æ˜¯å› ä¸ºä¼šæ‹¦æˆªå†™æ“ä½œï¼Œä»è€Œå¯¼è‡´æ³¢é¢çš„é€€åï¼Œäº§ç”Ÿâ€œå†—ä½™â€çš„æ‰«æã€‚</li></ul></li></ul></li></ul></li><li><p>æ··åˆå†™å±éšœï¼š</p><ul><li>go1.8ï¼Œä¸ºäº†ç®€åŒ– GC çš„æµç¨‹ï¼Œå‡å°‘æ ‡è®°ç»ˆæ­¢é˜¶æ®µçš„é‡æ‰«æˆæœ¬ã€‚åŒæ—¶ä½¿ç”¨Dijkstra æ’å…¥å±éšœå’ŒYuasa åˆ é™¤å±éšœï¼Œç§°ä¸ºæ··åˆå†™å±éšœã€‚</li><li>åŸºæœ¬æ€æƒ³ï¼š<strong>å¯¹æ­£åœ¨è¢«è¦†ç›–çš„å¯¹è±¡è¿›è¡Œç€è‰²ï¼ˆæ’å…¥å±éšœï¼‰ï¼Œä¸”å¦‚æœå½“å‰çº¿ç¨‹çš„è°ƒç”¨æ ˆæœªæ‰«æå®Œæˆï¼Œåˆ™åŒæ ·å¯¹æŒ‡é’ˆè¿›è¡Œç€è‰²ï¼ˆåˆ é™¤å±éšœï¼‰</strong></li><li>ç¼ºç‚¹ï¼šæ— æ¡ä»¶å¯¹å¼•ç”¨åŒæ–¹è¿›è¡Œç€è‰²ã€‚ç€è‰²æˆæœ¬åŒå€ï¼Œç¼–è¯‘å™¨æ’å…¥çš„ä»£ç ç¿»å€</li></ul></li><li><p>æ‰¹é‡å†™å±éšœï¼šå¼•å…¥ç¼“å­˜æœºåˆ¶</p><ul><li>go1.10 å‰åï¼Œå®ç°äº†æ‰¹é‡å†™å±éšœæœºåˆ¶</li><li>åŸºæœ¬æƒ³æ³•ï¼š<strong>å°†éœ€è¦ç€è‰²çš„æŒ‡é’ˆç»Ÿä¸€å†™å…¥ä¸€ä¸ªç¼“å­˜ï¼Œæ¯å½“ç¼“å­˜æ»¡æ—¶ç»Ÿä¸€å¯¹ç¼“å­˜ä¸­çš„æ‰€æœ‰æŒ‡é’ˆè¿›è¡Œç€è‰²</strong></li></ul></li></ul></li><li>Goè§¦å‘ GC çš„æ—¶æœºï¼š <ol><li>ä¸»åŠ¨ï¼šé€šè¿‡è°ƒç”¨ runtime.GC</li><li>è¢«åŠ¨ï¼š <ol><li>ç³»ç»Ÿç›‘æ§ï¼šå½“è¶…è¿‡ä¸¤åˆ†é’Ÿæ²¡æœ‰äº§ç”Ÿä»»ä½• GC æ—¶ï¼Œå¼ºåˆ¶è§¦å‘</li><li>æ­¥è°ƒç®—æ³•ï¼ˆPacingï¼‰ï¼šæ§åˆ¶å†…å­˜å¢é•¿çš„æ¯”ä¾‹</li></ol></li></ol><ul><li>å†…å­˜åˆ†é…è¿‡å¿«ï¼š <ul><li>GCè§¦å‘åï¼Œä¼šé¦–å…ˆè¿›å…¥å¹¶å‘æ ‡è®°çš„é˜¶æ®µè®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½enableMarkAssistã€‚åœ¨goroutineåˆ†é…å†…å­˜æ—¶ï¼Œèµ°åˆ°mallocgcå‡½æ•°ï¼Œæš‚åœå†…å­˜åˆ†é…è¿‡å¿«çš„goroutineå»æ‰§è¡Œç”¨æˆ·ä»£ç è½¬è€Œå»åšè¾…åŠ©æ ‡è®°çš„å·¥ä½œã€‚</li></ul></li></ul></li><li>GCçš„äº”ä¸ªé˜¶æ®µï¼š å½“å‰ç‰ˆæœ¬çš„ Go ä»¥ STW ä¸ºç•Œé™ï¼Œå¯ä»¥å°† GC åˆ’åˆ†ä¸ºäº”ä¸ªé˜¶æ®µï¼š <ul><li>STWæœŸé—´ï¼Œä¼šåœæ­¢ç”¨æˆ·ä»£ç çš„æ‰§è¡Œ</li><li>|é˜¶æ®µ|è¯´æ˜|èµ‹å€¼å™¨çŠ¶æ€| | :-----: | :-----: | :-----: | | SweepTermination |æ¸…æ‰«ç»ˆæ­¢é˜¶æ®µï¼Œä¸ºä¸‹ä¸€ä¸ªé˜¶æ®µçš„å¹¶å‘æ ‡è®°åšå‡†å¤‡å·¥ä½œï¼Œå¯åŠ¨å†™å±éšœ | STW | | Mark | å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œä¸èµ‹å€¼å™¨å¹¶å‘æ‰§è¡Œï¼Œå†™å±éšœå¼€å¯ | å¹¶å‘ | | MarkTermination |æ ‡è®°ç»“æŸé˜¶æ®µï¼Œä¿è¯ä¸€ä¸ªå‘¨æœŸå†…æ ‡è®°ä»»åŠ¡å®Œæˆï¼Œåœæ­¢å†™å±éšœ | STW | | GCoff |å†…å­˜æ¸…æ‰«é˜¶æ®µï¼Œå°†éœ€è¦å›æ”¶çš„å†…å­˜å½’è¿˜åˆ°å †ä¸­ï¼Œå†™å±éšœå…³é—­ | å¹¶å‘ | | GCoff |å†…å­˜å½’è¿˜é˜¶æ®µï¼Œå°†è¿‡å¤šçš„å†…å­˜å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œå†™å±éšœå…³é—­ | å¹¶å‘ |</li></ul></li></ul><ul><li>GC å…³æ³¨çš„æŒ‡æ ‡ï¼š <ul><li>CPUåˆ©ç”¨ç‡</li><li>åœé¡¿æ—¶é—´</li><li>åœé¡¿é¢‘ç‡</li><li>å¯æ‰©å±•æ€§</li></ul></li><li>GCè°ƒä¼˜ï¼šå‡å°‘ç”¨æˆ·ä»£ç å¯¹ GC äº§ç”Ÿçš„å‹åŠ› <ul><li>ä¼˜åŒ–å†…å­˜çš„ç”³è¯·é€Ÿåº¦ï¼Œé™åˆ¶goroutine çš„æ•°é‡</li><li>å°½å¯èƒ½çš„å°‘ç”³è¯·å†…å­˜ï¼ŒæŒ‰éœ€ç”³è¯·</li><li>å¤ç”¨å·²ç”³è¯·çš„å†…ï¼Œsync.Poolå¤ç”¨éœ€è¦çš„ buf</li><li>è°ƒæ•´GOGCå‚æ•°ï¼ˆæ²»æ ‡ä¸æ²»æœ¬ï¼‰</li></ul></li></ul><h3 id="goåç¨‹ã€çº¿ç¨‹å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#goåç¨‹ã€çº¿ç¨‹å¯¹æ¯”"><span>goåç¨‹ã€çº¿ç¨‹å¯¹æ¯”</span></a></h3><ul><li>å†…å­˜å¼€é”€ï¼š 2KB vs 2MB</li><li>åˆ›å»ºã€é”€æ¯å¼€é”€ï¼šç”¨æˆ·æ€ vs å†…æ ¸æ€</li><li>åˆ‡æ¢å¼€é”€ï¼š ä¿å­˜3ä¸ªå¯„å­˜å™¨ vs ä¿å­˜16ä¸ªå¯„å­˜å™¨</li></ul><h3 id="goè°ƒåº¦æ—¶æœº" tabindex="-1"><a class="header-anchor" href="#goè°ƒåº¦æ—¶æœº"><span>goè°ƒåº¦æ—¶æœº</span></a></h3><table><thead><tr><th>æƒ…å½¢</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å…³é”®å­— <code>go</code></td><td>åˆ›å»ºä¸€ä¸ªæ–°çš„ goroutineï¼ŒGo scheduler ä¼šè€ƒè™‘è°ƒåº¦</td></tr><tr><td>GC</td><td>ç”±äºè¿›è¡Œ GC çš„ goroutine ä¹Ÿéœ€è¦åœ¨ M ä¸Šè¿è¡Œï¼Œå› æ­¤è‚¯å®šä¼šå‘ç”Ÿè°ƒåº¦ã€‚å½“ç„¶ï¼ŒGo scheduler è¿˜ä¼šåšå¾ˆå¤šå…¶ä»–çš„è°ƒåº¦ï¼Œä¾‹å¦‚è°ƒåº¦ä¸æ¶‰åŠå †è®¿é—®çš„ goroutine æ¥è¿è¡Œã€‚</td></tr><tr><td>ç³»ç»Ÿè°ƒç”¨</td><td>å½“ g1 è¿›è¡Œç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä¼šé˜»å¡å¯¹åº”çš„m1ï¼Œg1ä¼šç»‘å®šåˆ°m1ä¸Šï¼Œg1å¯¹åº”çš„p1ä¼šä»m1è§£ç»‘ï¼Œé‡æ–°æ‰¾ä¸€ä¸ªç©ºé—²çš„m2ï¼Œæˆ–è€…æ–°å»ºä¸€ä¸ªm3ï¼Œç„¶åä»LRQè·å–g2è¿è¡Œï¼›å½“g1çš„ç³»ç»Ÿè°ƒç”¨å®Œæˆé‡æ–°å˜æˆå¯è¿è¡Œæ€ï¼Œä¼šè¢«æ”¾åˆ°å…¨å±€è¿è¡Œé˜Ÿåˆ—æˆ–è€…åŸæ¥çš„p1çš„æœ¬åœ°è¿è¡Œé˜Ÿåˆ—ï¼Œç­‰å¾…è°ƒåº¦çš„å‘ç”Ÿ</td></tr><tr><td>å†…å­˜åŒæ­¥è®¿é—®</td><td>åŒç³»ç»Ÿè°ƒç”¨ç±»ä¼¼ï¼Œatomicï¼Œmutexï¼Œchannel æ“ä½œä¼šé˜»å¡goroutine</td></tr></tbody></table><h3 id="go-runtimeã€programã€os-kernelçš„å…³ç³»" tabindex="-1"><a class="header-anchor" href="#go-runtimeã€programã€os-kernelçš„å…³ç³»"><span>go runtimeã€programã€os kernelçš„å…³ç³»</span></a></h3><figure><img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/48bd79bfd4ffca1fc578a6698cf9acf0.png" alt="Img" tabindex="0" loading="lazy"><figcaption>Img</figcaption></figure><ul><li>runtimeæœ‰ç‚¹ç±»ä¼¼ç”¨æˆ·è·Ÿç³»ç»Ÿäº¤äº’çš„ä¸­é—´ä»£ç†</li><li>runtimeç»´æŠ¤æ‰€æœ‰çš„ goroutinesï¼Œé€šè¿‡scheduleræ¥è¿›è¡Œè°ƒåº¦</li><li>scheduler ç›¸å…³ç»“æ„ä½“ç»„æˆï¼š <ul><li><code>g</code> ä»£è¡¨ä¸€ä¸ª goroutineï¼Œå®ƒåŒ…å«ï¼šgoroutineæ ˆçš„ä¸€äº›å­—æ®µï¼Œå½“å‰ goroutine çš„çŠ¶æ€ï¼Œå½“å‰è¿è¡Œåˆ°çš„æŒ‡ä»¤åœ°å€</li><li><code>m</code> è¡¨ç¤ºå†…æ ¸çº¿ç¨‹ï¼ŒåŒ…å«æ­£åœ¨è¿è¡Œçš„ goroutine ç­‰å­—æ®µ</li><li><code>p</code> ä»£è¡¨ä¸€ä¸ªè™šæ‹Ÿçš„ Processorï¼Œå®ƒç»´æŠ¤ä¸€ä¸ªå¤„äºRunnableçŠ¶æ€çš„ g é˜Ÿåˆ—ï¼ˆæœ¬åœ°å¯è¿è¡Œé˜Ÿåˆ—LRQï¼‰å’Œä¸€ä¸ªMï¼Œæ˜¯è¿æ¥Goroutineå’Œçº¿ç¨‹çš„æ¡¥æ¢</li><li><code>sched</code> æ€»è§ˆå…¨å±€</li></ul></li></ul><h3 id="gpm" tabindex="-1"><a class="header-anchor" href="#gpm"><span>GPM</span></a></h3><ul><li><p>GPMçŠ¶æ€æœºï¼š <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/ee5b938c62f75a47aae6c7400f0358f7.png" alt="Img" loading="lazy"></p><ul><li>GçŠ¶æ€æœºï¼š <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/7718933e3b9eef5324dcfec3ac53aa2b.png" alt="Img" loading="lazy"></li><li>PçŠ¶æ€æœºï¼š <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/c1c6bafe989c43be7b23e474d0668f24.png" alt="Img" loading="lazy"></li><li>MçŠ¶æ€æœºï¼š <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/a11695f322399e06a43b359adc2e4148.png" alt="Img" loading="lazy"></li></ul></li><li><p>GPMå®Œæ•´æµç¨‹å›¾ï¼š <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/341ae661ef2b4867952a913a4681448f.png" alt="Img" loading="lazy"> 1ã€ GPM çš„è°ƒåº¦æµç¨‹ä» go func()å¼€å§‹åˆ›å»ºä¸€ä¸ª goroutine,æ–°å»ºçš„Gä¼˜å…ˆæ”¾å…¥Pçš„æœ¬åœ°é˜Ÿåˆ—ä¿å­˜å¾…æ‰§è¡Œçš„ goroutineï¼ˆæµç¨‹ 2ï¼‰ï¼Œå½“ M ç»‘å®šçš„ P çš„çš„å±€éƒ¨é˜Ÿåˆ—å·²ç»æ»¡äº†ä¹‹åå°±ä¼šæŠŠ goroutine æ”¾åˆ°å…¨å±€é˜Ÿåˆ—ï¼ˆæµ ç¨‹ 2-1ï¼‰ 2ã€æ¯ä¸ª P å’Œä¸€ä¸ª M ç»‘å®šï¼ŒM æ˜¯çœŸæ­£çš„æ‰§è¡Œ P ä¸­ goroutine çš„å®ä½“ï¼ˆæµç¨‹ 3ï¼‰ï¼Œ M ä»ç»‘å®šçš„ P ä¸­çš„å±€éƒ¨é˜Ÿåˆ—è·å– G æ¥æ‰§è¡Œ 3ã€å½“ M ç»‘å®šçš„ P çš„å±€éƒ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼ŒM ä¼šä»å…¨å±€é˜Ÿåˆ—è·å–åˆ°æœ¬åœ°é˜Ÿåˆ—æ¥æ‰§è¡Œ G ï¼ˆæµç¨‹ 3.1ï¼‰ï¼Œå½“ä»å…¨å±€é˜Ÿåˆ—ä¸­æ²¡æœ‰è·å–åˆ°å¯æ‰§è¡Œçš„ G æ—¶å€™ï¼ŒM ä¼šä»å…¶ä»– P çš„å±€éƒ¨é˜Ÿåˆ—ä¸­å·å– G æ¥æ‰§è¡Œï¼ˆæµç¨‹ 3.2ï¼‰ï¼Œè¿™ç§ä»å…¶ä»– P å·çš„æ–¹å¼ç§°ä¸º work stealing 4ã€ä¸€ä¸ªMè°ƒåº¦Gæ‰§è¡Œçš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªå¾ªç¯æœºåˆ¶ 5ã€ å½“ G å› ç³»ç»Ÿè°ƒç”¨ï¼ˆsyscallï¼‰é˜»å¡æ—¶ä¼šé˜»å¡ Mï¼Œæ­¤æ—¶ P ä¼šå’Œ M è§£ç»‘å³ hand offï¼Œå¹¶å¯»æ‰¾æ–°çš„ç©ºé—²çš„ Mï¼Œè‹¥æ²¡æœ‰ç©ºé—²çš„ M å°±ä¼šæ–°å»ºä¸€ä¸ª Mï¼ˆæµç¨‹ 5.1ï¼‰ 6ã€å½“ G <span style="color:rgb(255, 76, 0);">å›  channel æˆ–è€… network I/O é˜»å¡æ—¶ï¼Œä¸ä¼šé˜»å¡ Mï¼ŒM ä¼šå¯»æ‰¾å…¶ä»–çš„ G</span>ï¼›å½“é˜»å¡çš„ G æ¢å¤åä¼šé‡æ–°è¿›å…¥ runnable è¿›å…¥ P é˜Ÿåˆ—ç­‰å¾…æ‰§ è¡Œï¼ˆæµç¨‹ 5.3ï¼‰ 7ã€ å½“Mç³»ç»Ÿè°ƒç”¨ç»“æŸæ—¶å€™ï¼Œè¿™ä¸ªGä¼šå°è¯•è·å–ä¸€ä¸ªç©ºé—²çš„Pæ‰§è¡Œï¼Œå¹¶æ”¾å…¥åˆ°è¿™ä¸ªPçš„æœ¬åœ°é˜Ÿåˆ—ã€‚å¦‚æœè·å–ä¸åˆ°Pï¼Œåˆ™å°†Gæ”¾å…¥å…¨å±€é˜Ÿåˆ—ï¼Œç­‰å¾…è¢«å…¶ä»–çš„Pè°ƒåº¦ã€‚ç„¶åMå°†è¿›å…¥ç¼“å­˜æ± ç¡çœ ã€‚</p></li><li><p>GMPè°ƒåº¦è¿‡ç¨‹ä¸­å­˜åœ¨å“ªäº›é˜»å¡ï¼š</p><ul><li>I/Oï¼Œselect</li><li>syscall</li><li>channel</li><li>ç­‰å¾…é”</li><li>runtime.Gosched()</li></ul></li><li><p>GMPè°ƒåº¦å‡ºç°é˜»å¡æ—¶ï¼š</p><ul><li>é˜»å¡çš„åŸå› æ˜¯åŒæ­¥çš„ï¼ˆå¦‚ç³»ç»Ÿè°ƒç”¨æˆ–é”æ“ä½œï¼‰ï¼Œå¯¹åº”çš„Mä¼šé˜»å¡</li><li>é˜»å¡çš„åŸå› æ˜¯å¼‚æ­¥çš„ï¼ˆå¦‚ç½‘ç»œI/Oæˆ–é€šé“æ“ä½œï¼‰ï¼Œå¯¹åº”çš„Mä¸ä¼šé˜»å¡</li></ul></li><li><p>M:Næ¨¡å‹ï¼š</p><ul><li>Nä¸ªgo routineé€šè¿‡è‹¥å¹²ä¸ªPä¾é™„åœ¨Mä¸ªçº¿ç¨‹ï¼ˆMï¼‰ä¸Š</li></ul></li><li><p>å·¥ä½œçªƒå–ï¼š</p><ul><li>å½“å‰Pçš„LRQç©ºäº†åï¼Œä¼šä»å…¶ä»–På·å–ä¸€åŠçš„G</li></ul></li></ul><h3 id="å‡½æ•°æ ˆã€è°ƒç”¨æ ˆã€è¿è¡Œæ ˆ" tabindex="-1"><a class="header-anchor" href="#å‡½æ•°æ ˆã€è°ƒç”¨æ ˆã€è¿è¡Œæ ˆ"><span>å‡½æ•°æ ˆã€è°ƒç”¨æ ˆã€è¿è¡Œæ ˆ</span></a></h3><ul><li>è°ƒç”¨æ ˆ=è¿è¡Œæ ˆ</li><li>è°ƒç”¨æ ˆç”±è‹¥å¹²ä¸ªæœ‰è°ƒç”¨å…³ç³»çš„å‡½æ•°æ ˆç»„æˆ</li><li>å‡½æ•°æ ˆç”¨æ ˆç»“æ„å­˜å‚¨å‡½æ•°çš„å±€éƒ¨å˜é‡ã€å‚æ•°å’Œè¿”å›åœ°å€ç­‰ä¿¡æ¯</li></ul><h3 id="æ ˆå†…å­˜å’Œæ ˆç©ºé—´" tabindex="-1"><a class="header-anchor" href="#æ ˆå†…å­˜å’Œæ ˆç©ºé—´"><span>æ ˆå†…å­˜å’Œæ ˆç©ºé—´</span></a></h3><ul><li>æ ˆ Stackç”¨æ¥æè¿°ä¸€ç§&quot;åè¿›å…ˆå‡º&quot;ï¼ˆLIFOï¼‰çš„æ•°æ®ç»“æ„</li><li>æ ˆå†…å­˜æ˜¯æŒ‡è®¡ç®—æœºå†…å­˜ä¸­çš„ä¸€å—ç‰¹æ®ŠåŒºåŸŸï¼Œå®ƒç”±æ“ä½œç³»ç»Ÿåœ¨ç¨‹åºå¯åŠ¨æ—¶åˆ†é…</li><li>æ ˆç©ºé—´æ˜¯æŒ‡ä¸ºgoroutineåˆ†é…çš„ç”¨äºå­˜å‚¨å‡½æ•°è°ƒç”¨æ ˆçš„å†…å­˜åŒºåŸŸï¼Œå‡½æ•°è¿”å›å†…å­˜ä¼šè¢«é‡Šæ”¾</li><li>æ ˆç©ºé—´å¤§å¤šæ•°éƒ½æ˜¯ä½äºæ ˆå†…å­˜ä¸­çš„</li><li>åœ¨Goè¯­è¨€ä¸­ï¼Œgoroutineçš„æ ˆç©ºé—´å¯èƒ½ä¼šè¢«åˆ†é…åœ¨å †å†…å­˜ä¸­ã€‚ç‰©ç†ä½ç½®ä¸Šä½äºå †å†…å­˜ï¼Œä½†é€»è¾‘ç»“æ„ç¬¦åˆæ ˆçš„ç‰¹æ€§ï¼Œå› æ­¤ä»ç„¶ç§°ä¹‹ä¸ºæ ˆç©ºé—´</li></ul><h3 id="sysmon" tabindex="-1"><a class="header-anchor" href="#sysmon"><span>sysmonï¼š</span></a></h3><ul><li>sysmonè¿è¡Œåœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸Šï¼Œä¸ä¾èµ–Pã€Mï¼Œè¿›è¡Œæ— é™å¾ªç¯</li><li>sysmonçš„ä½œç”¨ï¼š <ul><li>é•¿æ—¶é—´ï¼ˆ2minï¼‰æœªå‘ç”Ÿgcï¼Œå¼ºåˆ¶æ‰§è¡Œgc</li><li>è·å–fdäº‹ä»¶ï¼Ÿï¼Ÿ</li><li>æŠ¢å ï¼Œå›æ”¶ç³»ç»Ÿè°ƒç”¨ä¸­çš„Gå¯¹åº”çš„Pï¼ŒæŠ¢å é•¿æ—¶é—´ï¼ˆ10msï¼‰è¿è¡Œçš„P</li><li>é‡Šæ”¾è‡ªç”±åˆ—è¡¨ä¸­å¤šä½™çš„é¡¹å‡å°‘å†…å­˜å ç”¨</li></ul></li></ul></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="vp-meta-info" data-allow-mismatch="text">2025/6/21 14:30:17</span></div><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/gc.html" aria-label="gc" iconsizing="both"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->gc</div></a><a class="route-link auto-link next" href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/golang/goroutine.html" aria-label="goroutine" iconsizing="both"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">goroutine<!----></div></a></nav><div id="comment" class="waline-wrapper vp-comment" vp-comment darkmode="false" style="display:block;"><!----></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><!----><div class="vp-copyright">
  ç‰ˆæƒå£°æ˜ï¼šè‡ªç”±è½¬è½½ - éå•†ç”¨ - éè¡ç”Ÿ - ä¿æŒç½²å<a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh-hans" target="_blank" rel="noopener noreferrer">ï¼ˆåˆ›æ„å…±äº« 4.0 è®¸å¯è¯ï¼‰</a>|
  Copyright Â© 2024-present Navyum</a>
  </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.4343b326.js" defer></script><script src="/assets/js/1181.88d0b359.js" defer></script><script src="/assets/js/app.0aa5305f.js" defer></script>
    <!-- çœ‹æ¿å¨˜åŒºå— -->
    <script src="/live2d-widget/autoload.js"></script>
    <!-- End çœ‹æ¿å¨˜åŒºå— -->

    <!-- ahrefsåˆ†æ-->
    <script src="https://analytics.ahrefs.com/analytics.js" data-key="7WraP4W+AhiZ1hvRy398kQ" async></script>

  </body>
</html>

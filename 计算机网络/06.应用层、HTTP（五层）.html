<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="keywords" content="自我提升,效率提升,职场经验,学习笔记" />
    <meta name="360-site-verification" content="deb32fab1ab57ddf02d8c5b4cc37025c" />
    <meta name="msvalidate.01" content="034FE00C2DAE4BC3B10D36ABBE467614" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #4089ab;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <!--  #252232 --> 
    <meta property="og:url" content="https://myblog.camscanner.top/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/06.%E5%BA%94%E7%94%A8%E5%B1%82%E3%80%81HTTP%EF%BC%88%E4%BA%94%E5%B1%82%EF%BC%89.html"><meta property="og:site_name" content="Navyum's Blog"><meta property="og:title" content="08.应用层、HTTP（五层）"><meta property="og:description" content="HTTP 发送格式： 图片图片 响应格式： 图片图片 HTTPS 与HTTP相比，多了SSL/TLS 握手协议 概念：前向安全性： 密钥泄露后，即使拿到以前的记录，也无法通过密钥进行破解 RSA、DH加密算法是非前向安全的；ECDHE是前向安全的 SSL/TLS 握手协议： 目的： 通过非对称加密算法，握手后协商出对称加密密钥 花费： 2 RTT TL..."><meta property="og:type" content="article"><meta property="og:image" content="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/3e072d70ba9af070642f25856b372028.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-06-23T09:35:21.000Z"><meta property="article:author" content="Navyum"><meta property="article:tag" content="HTTP"><meta property="article:tag" content="HTTP2"><meta property="article:tag" content="TLS"><meta property="article:tag" content="QUIC"><meta property="article:tag" content="HTTP3"><meta property="article:published_time" content="2024-03-31T23:52:11.000Z"><meta property="article:modified_time" content="2025-06-23T09:35:21.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"08.应用层、HTTP（五层）","image":["https://raw.staticdn.net/Navyum/imgbed/pic/IMG/3e072d70ba9af070642f25856b372028.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/31bc1a1c077cb1ef967ba20d2cda4c55.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/6e438da1013944db557141a57deb690b.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/8e1a73d1c9158a0ec1040f1777f6019e.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/1277641be6ab34323df77c4f02950142.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/c4803aa491fcfd5ebfde9045d606c748.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/6d7699ba78eba5dae358267adbf382e8.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/c42e845055af9f5a4ceb78dafd14087a.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/22170a9e46dad8ff73adff878d2ede0a.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/048a9b0325f365cd4f0bc626fa106ebf.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/8fae57c8dcf3faf0f41577042bd9ec58.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/7ddf8f4fadc857fe081fd2008950a987.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/0e49e74abc6c7694352d3642d59bdb5d.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/1e1b1cd669b4881acee9400ff91bb680.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/f443e834f43f34c9e2e0647d29b8c24c.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/c33058203fdba04e7b5337171eaf8756.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/7569ef8b54999da315b58a34914cf392.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/d1d2180748b4f6e04c42da9e54754b2a.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/6fda22d5782f5f61402846f9e21d018a.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/f02bf0f32626d8a7f3e43ecb3efc4291.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/d5a20c3165d8a69314170350c88d2dab.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/1e1b1cd669b4881acee9400ff91bb680.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/386bc276ab8dd65901f640bd19e7a20d.png","https://raw.staticdn.net/Navyum/imgbed/pic/IMG/66735265a54c7ed385a2a94b88e4cda4.png"],"datePublished":"2024-03-31T23:52:11.000Z","dateModified":"2025-06-23T09:35:21.000Z","author":[{"@type":"Person","name":"Navyum"}]}</script><link rel="alternate" type="application/atom+xml" href="https://myblog.camscanner.top/atom.xml" title="Navyum's Blog Atom Feed"><link rel="alternate" type="application/json" href="https://myblog.camscanner.top/feed.json" title="Navyum's Blog JSON Feed"><link rel="alternate" type="application/rss+xml" href="https://myblog.camscanner.top/rss.xml" title="Navyum's Blog RSS Feed"><link rel="icon" href="/favicon.ico"><title>08.应用层、HTTP（五层） | Navyum's Blog</title><meta name="description" content="HTTP 发送格式： 图片图片 响应格式： 图片图片 HTTPS 与HTTP相比，多了SSL/TLS 握手协议 概念：前向安全性： 密钥泄露后，即使拿到以前的记录，也无法通过密钥进行破解 RSA、DH加密算法是非前向安全的；ECDHE是前向安全的 SSL/TLS 握手协议： 目的： 通过非对称加密算法，握手后协商出对称加密密钥 花费： 2 RTT TL...">
    <link rel="stylesheet" href="/assets/css/styles.08b9eca3.css">
    <link rel="preload" href="/assets/js/runtime~app.4343b326.js" as="script"><link rel="preload" href="/assets/css/styles.08b9eca3.css" as="style"><link rel="preload" href="/assets/js/1181.88d0b359.js" as="script"><link rel="preload" href="/assets/js/app.0aa5305f.js" as="script">
    
    <!-- 统计代码区域-->
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/" aria-label="带我回家"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">Navyum&#39;s Blog</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="主页" iconsizing="height"><!--[--><iconify-icon class="vp-icon" icon="meteor-icons:home" height="1em" sizing="height"></iconify-icon><!--]-->主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/blog.html" aria-label="博客" iconsizing="height"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:blog" height="1em" sizing="height"></iconify-icon><!--]-->博客<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="思考"><!--[--><iconify-icon class="vp-icon" icon="icon-park-outline:thinking-problem" height="1em" sizing="height"></iconify-icon>思考<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E9%9D%A2%E8%AF%95%E7%BB%8F%E9%AA%8C/" aria-label="面试经验" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="fluent:people-chat-24-regular" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->面试经验<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E4%B8%AA%E4%BA%BA%E6%80%9D%E8%80%83/" aria-label="个人思考" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="icon-park-outline:thinking-problem" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->个人思考<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/%E6%88%91%E7%9A%84%E4%B8%96%E7%95%8C/" aria-label="我的世界" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="streamline-plump:world-remix" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->我的世界<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="auto-link external-link" href="https://www.notion.so/navyum/1c42fcd1fefa4e948d8514761b2ab8c7?v=0ca5dc6ee29e4c2787dbd0f1055b4ed0" aria-label="读书" rel="noopener noreferrer" target="_blank" iconsizing="height"><!--[--><iconify-icon class="vp-icon" icon="fa6-brands:readme" height="1em" sizing="height"></iconify-icon><!--]-->读书<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/intro.html" aria-label="联系" iconsizing="height"><!--[--><iconify-icon class="vp-icon" icon="streamline-plump:contact-phonebook-solid" height="1em" sizing="height"></iconify-icon><!--]-->联系<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/map.html" aria-label="导航" iconsizing="height"><!--[--><iconify-icon class="vp-icon" icon="streamline-plump:world-remix" height="1em" sizing="height"></iconify-icon><!--]-->导航<!----></a></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/navyum" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><iconify-icon class="vp-icon" icon="icon-park-outline:computer" width="1em" height="1em" sizing="both"></iconify-icon><span class="vp-sidebar-title">计算机网络</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/01.%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B.html" aria-label="01.网络模型" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="zondicons:network" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->01.网络模型<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/02.%E7%89%A9%E7%90%86%E5%B1%82%EF%BC%88%E4%B8%80%E5%B1%82%EF%BC%89.html" aria-label="02.物理层（一层）" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="zondicons:network" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->02.物理层（一层）<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/03.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%81MAC%EF%BC%88%E4%BA%8C%E5%B1%82%EF%BC%89.html" aria-label="03.数据链路层、MAC（二层）" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="zondicons:network" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->03.数据链路层、MAC（二层）<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/04.%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%81IP%EF%BC%88%E4%B8%89%E5%B1%82%EF%BC%89.html" aria-label="04.网络层、IP（三层）" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="bxs:hot" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->04.网络层、IP（三层）<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/05.%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%81TCP%EF%BC%88%E5%9B%9B%E5%B1%82%EF%BC%89.html" aria-label="05.传输层、TCP（四层）" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="bxs:hot" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->05.传输层、TCP（四层）<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/06.%E5%BA%94%E7%94%A8%E5%B1%82%E3%80%81HTTP%EF%BC%88%E4%BA%94%E5%B1%82%EF%BC%89.html" aria-label="08.应用层、HTTP（五层）" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="bxs:hot" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->08.应用层、HTTP（五层）<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/07.%E7%BD%91%E7%BB%9CIO%E6%8A%80%E6%9C%AF-%E9%98%BB%E5%A1%9E%E3%80%81%E9%9D%9E%E9%98%BB%E5%A1%9E%E3%80%81%E5%90%8C%E6%AD%A5%E3%80%81%E5%BC%82%E6%AD%A5.html" aria-label="09.网络IO-阻塞、同步" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="zondicons:network" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->09.网络IO-阻塞、同步<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/08.%E7%BD%91%E7%BB%9C%E6%96%87%E4%BB%B6IO%E4%BC%98%E5%8C%96.html" aria-label="10.网络文件IO优化" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="bxs:hot" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->10.网络文件IO优化<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/09.SSH%E5%85%AC%E7%A7%81%E9%92%A5%E9%AA%8C%E8%AF%81.html" aria-label="11.SSH公私钥验证" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="bxs:hot" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->11.SSH公私钥验证<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/10.socket%E7%BC%96%E7%A8%8B.html" aria-label="12.socket编程" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="zondicons:network" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->12.socket编程<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/50.%E5%B8%B8%E8%A7%81%E7%9A%84%E9%A2%98%E7%9B%AE.html" aria-label="50.常见的题目" iconsizing="both"><!--[--><iconify-icon class="vp-icon" icon="zondicons:network" width="1em" height="1em" sizing="both"></iconify-icon><!--]-->50.常见的题目<!----></a></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="vp-icon" icon="bxs:hot" height="1em" sizing="height"></iconify-icon>08.应用层、HTTP（五层）</h1><div class="page-info"><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color1 clickable" role="navigation">网络</span><!--]--><meta property="articleSection" content="网络"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color4 clickable" role="navigation">HTTP</span><span class="page-tag-item color7 clickable" role="navigation">HTTP2</span><span class="page-tag-item color6 clickable" role="navigation">TLS</span><span class="page-tag-item color3 clickable" role="navigation">QUIC</span><span class="page-tag-item color5 clickable" role="navigation">HTTP3</span><!--]--><meta property="keywords" content="HTTP,HTTP2,TLS,QUIC,HTTP3"></span><span class="page-word-info" aria-label="字数🔠" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 4653 字</span><meta property="wordCount" content="4653"></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 16 分钟</span><meta property="timeRequired" content="PT16M"></span><span class="page-pageview-info" aria-label="访问量🔢" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon" name="eye"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span id="ArtalkPV" class="vp-pageview waline-pageview-count" data-path="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/06.%E5%BA%94%E7%94%A8%E5%B1%82%E3%80%81HTTP%EF%BC%88%E4%BA%94%E5%B1%82%EF%BC%89.html" data-page-key="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/06.%E5%BA%94%E7%94%A8%E5%B1%82%E3%80%81HTTP%EF%BC%88%E4%BA%94%E5%B1%82%EF%BC%89.html">...</span></span></div><hr></div><!----><!----><div class="theme-hope-content" vp-content><h2 id="http" tabindex="-1"><a class="header-anchor" href="#http"><span>HTTP</span></a></h2><h4 id="发送格式" tabindex="-1"><a class="header-anchor" href="#发送格式"><span>发送格式：</span></a></h4><figure><img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/3e072d70ba9af070642f25856b372028.png" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><h4 id="响应格式" tabindex="-1"><a class="header-anchor" href="#响应格式"><span>响应格式：</span></a></h4><figure><img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/31bc1a1c077cb1ef967ba20d2cda4c55.png" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><h2 id="https" tabindex="-1"><a class="header-anchor" href="#https"><span>HTTPS</span></a></h2><h4 id="与http相比-多了ssl-tls-握手协议" tabindex="-1"><a class="header-anchor" href="#与http相比-多了ssl-tls-握手协议"><span>与HTTP相比，多了SSL/TLS 握手协议</span></a></h4><h4 id="概念-前向安全性" tabindex="-1"><a class="header-anchor" href="#概念-前向安全性"><span>概念：前向安全性：</span></a></h4><ul><li>密钥泄露后，即使拿到以前的记录，也无法通过密钥进行破解</li><li>RSA、DH加密算法是非前向安全的；ECDHE是前向安全的</li></ul><h4 id="ssl-tls-握手协议" tabindex="-1"><a class="header-anchor" href="#ssl-tls-握手协议"><span>SSL/TLS 握手协议：</span></a></h4><ul><li>目的： <ul><li><code>通过非对称加密算法，握手后协商出对称加密密钥</code></li></ul></li><li>花费： <ul><li>2 RTT <ul><li>TLS 1.2 通常情况下</li></ul></li><li>1 RTT <ul><li>使用会话复用技术后</li></ul></li><li>0 RTT <ul><li>TLS 1.3 使用会话复用和<code>Pre-shared Key</code>（请求和Ticket一起发）</li></ul></li></ul></li></ul><h4 id="tls-密钥套件ciper-suite" tabindex="-1"><a class="header-anchor" href="#tls-密钥套件ciper-suite"><span>TLS 密钥套件<code>Ciper suite</code>：</span></a></h4><ul><li>格式： <ul><li>TLS + 密钥协商算法 + 证书签名算法 + WITH + 对称加密算法 + 摘要算法</li></ul></li><li>举例：TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256（TLS 1.2）</li><li>算法说明： <ul><li>密钥协商算法：TLS阶段，用于生成对称密钥或者加密对称密钥的要素（要素加密）</li><li>签名算法：TLS阶段，用户客户端校验服务器证书有效性、ECDHE公钥的有效性（证书校验）</li><li>对称加密算法：TLS完成后，数据传输时加密（数据传输）</li><li>摘要算法：TLS最后阶段，对密钥协商过程数据做摘要并验证（过程验证）</li></ul></li><li>举例：TLS_AES_256_GCM_SHA384（TLS 1.3） <ul><li>密钥协商算法不在套件内，而是通过<code>key_share</code>扩展指定</li><li>签名算法不在套件内，而是通过<code>signature_algorithms</code>扩展指定 <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/6e438da1013944db557141a57deb690b.png" alt="Img" loading="lazy"></li></ul></li></ul><h4 id="tls-1-2-ecdhe-握手过程" tabindex="-1"><a class="header-anchor" href="#tls-1-2-ecdhe-握手过程"><span>TLS 1.2 （ECDHE）握手过程：</span></a></h4><figure><img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/8e1a73d1c9158a0ec1040f1777f6019e.png" alt="Img" tabindex="0" loading="lazy"><figcaption>Img</figcaption></figure><ul><li><code>TCP 握手、挥手过程在内核协议栈进行</code>,<code>TLS在应用层</code></li><li><code>TLS第一次握手</code>： <ul><li>客户端发 <code>client hello</code>消息 <ul><li>消息包含：客户端TLS 版本号、支持的密码套件列表、客户端随机数</li></ul></li></ul></li><li><code>TLS第二次握手</code>： <ul><li>服务端发 <code>server hello</code>消息 <ul><li>消息包含：协商后的TLS 版本号、协商后的协议套件、服务端随机数</li></ul></li><li>服务端发 <code>certificate</code>消息 <ul><li>消息包含：证书、证书对应的签名</li></ul></li><li>服务端生成用于协议传输的公、私钥（基于协商的协议套件）</li><li>服务端发 <code>serverKeyExchange</code>消息（ECDHE有该过程，RSA没有） <ul><li>消息包含：ECDHE公钥、公钥签名、椭圆曲线的参数</li></ul></li><li>服务端发 <code>serverHelloDone</code>消息 <ul><li>消息包含：服务端协商相关数据已传输结束</li></ul></li></ul></li><li><code>TLS第三次握手</code>： <ul><li>客户端验证证书有效性（通过CA或者OSCP stampling）</li><li>客户端生成用于协议传输的公、私钥（基于协商的协议套件）</li><li>客户端发 <code>clientKeyExchange</code>消息 <ul><li>ECDHE 消息包含：ECDHE公钥、公钥签名、椭圆曲线的参数</li><li>RSA 消息包含：使用服务端证书公钥加密<code>premaster secret</code>后的字符串</li></ul></li><li>客户端发 <code>changeCipherSpec</code>消息 <ul><li>计算出对称加密密钥，即会话密钥 <ul><li>ECDHE：双端公钥+椭圆曲线的参数+双端随机数</li><li>RSA：pre-master secret+双端随机数</li></ul></li><li>消息包含：通知服务端后续使用对称加密</li></ul></li><li>客户端发 <code>Encrypted Handshake Message</code>消息 <ul><li>先使用摘要算法，计算协商过程产生的数据摘要</li><li>客户端再使用对称加密的会话密钥对摘要加密 <ul><li>消息包含：加密的摘要</li></ul></li></ul></li></ul></li><li><code>TLS第四次握手</code>：（ECDHE时，客户端无需等待第四次完成即可发用户数据） <ul><li>服务端发 <code>changeCipherSpec</code>消息 <ul><li>使用私钥解密出pre-master secret，计算出对称加密密钥，即会话密钥 <ul><li>ECDHE：双端公钥+椭圆曲线的参数+双端随机数</li><li>RSA：pre-master secret+双端随机数</li></ul></li><li>消息包含：通知客户端后续使用对称加密</li></ul></li><li>服务端发 <code>Encrypted Handshake Message</code>消息 <ul><li>先使用摘要算法，计算协商过程产生的数据摘要</li><li>服务端再使用对称加密的会话密钥对摘要加密</li><li>消息包含：加密的摘要</li></ul></li></ul></li></ul><h4 id="tls-1-2-和-1-3对比" tabindex="-1"><a class="header-anchor" href="#tls-1-2-和-1-3对比"><span>TLS 1.2 和 1.3对比：</span></a></h4><figure><img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/1277641be6ab34323df77c4f02950142.png" alt="Img" tabindex="0" loading="lazy"><figcaption>Img</figcaption></figure><ul><li>性能：TLS 1.2 握手4次，2RTT；TLS 1.3 握手2次，1RTT</li><li>安全：TLS 1.3 将支持的密码套件缩减到五个，但都是<code>前向安全</code>的</li></ul><h4 id="tls-握手性能优化" tabindex="-1"><a class="header-anchor" href="#tls-握手性能优化"><span>TLS 握手性能优化：</span></a></h4><ul><li>硬件优化： <ul><li>提升CPU性能（HTTPS协议是计算密集型）</li></ul></li><li>软件优化： <ul><li>软件升级：openssl</li><li>协议升级： <ul><li>使用TLS 1.3</li><li>密钥交换算法使用<code>ECDHE</code>（替换<code>RSA</code>）</li></ul></li><li>证书优化： <ul><li>证书传输： <ul><li>选择使用<code>ECDSA</code>替换<code>RSA</code>（前者协议数据更小）</li></ul></li><li>验证过程： <ul><li><code>OCSP</code> 在线证书状态协议：向CA查询证书的有效状态，按需查询。建议使用。</li><li><code>CRL</code> 证书吊销列表：向CA拉取证书吊销列表，一次查全量，但数据太大。</li><li><code>OCSP Stapling</code>： <ul><li>原先为了验证的服务器的身份，服务器会在 TLS 握手过程中，把自己的证书发给客户端用于验证</li><li>使用<code>OCSP Stapling</code>，服务端向CA周期性地查询证书状态，在握手时返回给客户端，这样客户端就不用再去查询有效性了</li></ul></li></ul></li></ul></li></ul></li><li>工程优化： <ul><li>会话复用： <ul><li>含义：把首次TLS握手协商的对称加密密钥缓存起来，后续需要建立 HTTPS 连接时，直接复用</li><li>基于<code>Session ID</code>： <ul><li>服务端和客户端都缓存。使用唯一Session ID将密钥缓存到内存</li></ul></li><li>基于<code>Session Ticket</code>： <ul><li>仅客户端缓存。客户端握手时上传<code>Session Ticket</code>，服务端解密验证</li></ul></li><li>基于<code>Pre-shared Key</code>： <ul><li>在 TLS 1.3支持</li><li>客户端重连后，不进行握手，而是直接发 HTTP请求，将<code>Session Ticket</code>同时传给服务器</li></ul></li></ul></li><li>会话复用的缺点： <ul><li>非前向安全</li><li>无法应对重放攻击</li><li>应对方法：需要设置好有效期</li></ul></li></ul></li></ul><h4 id="实战经验" tabindex="-1"><a class="header-anchor" href="#实战经验"><span>实战经验：</span></a></h4><ul><li>wireshark解析TLS加密报文： <ul><li>修改系统环境变量：export SSLKEYLOGFILE=&quot;/data/sslkeylogfile&quot;</li><li>修改wireshark配置 <ul><li>【编辑】-&gt;【首选项】-&gt;【Protocols】-&gt;【TLS】-&gt;【Pre-Master Secret log】-&gt; &quot;/data/sslkeylogfile&quot;</li></ul></li></ul></li></ul><h2 id="http-1-0" tabindex="-1"><a class="header-anchor" href="#http-1-0"><span>HTTP/1.0</span></a></h2><ul><li>略过</li></ul><h2 id="http-1-1" tabindex="-1"><a class="header-anchor" href="#http-1-1"><span>HTTP/1.1</span></a></h2><ul><li>基于TCP，使用文本进行传输</li></ul><h4 id="http-1-1-的改进" tabindex="-1"><a class="header-anchor" href="#http-1-1-的改进"><span>HTTP/1.1 的改进：</span></a></h4><ul><li>长连接：复用TCP连接，避免TCP握手的消耗</li><li>管道网络传输（pipeline）：客户端的请求可以并发，但服务端响应需要有序（HTTP2.0 解决）</li><li>缓存策略：更复杂的缓存，协商缓存</li><li>大文件范围请求Range：断点续传</li><li>必须要Host头字段：一台服务器可以托管多个域名的网站</li></ul><h4 id="http-1-1-存在的问题" tabindex="-1"><a class="header-anchor" href="#http-1-1-存在的问题"><span>HTTP/1.1 存在的问题：</span></a></h4><ul><li><code>并发连接有限</code>： <ul><li>浏览器最大并发连接数是 6 个</li><li>TCP 和 TLS 握手耗时</li></ul></li><li><code>HTTP队头阻塞问题</code>： <ul><li>同一连接只能在完成一个 HTTP 事务（请求和响应）后，才能处理下一个事务</li></ul></li><li><code>HTTP头部</code>巨大且重复</li><li>不支持服务器推送消息，需要通过轮询方式</li></ul><h4 id="针对-http-1-1-优化手段" tabindex="-1"><a class="header-anchor" href="#针对-http-1-1-优化手段"><span>针对 HTTP/1.1 优化手段：</span></a></h4><ul><li>减少请求： <ul><li>缓存数据、304 Not Modify</li><li>减少重定向次数</li><li>合并请求</li><li>按需获取</li></ul></li><li>数据压缩： <ul><li>Accept-Encoding、Content-Encoding</li><li>无损压缩：gzip</li><li>有损压缩：webp、png、heif</li></ul></li></ul><h2 id="http-2-0" tabindex="-1"><a class="header-anchor" href="#http-2-0"><span>HTTP/2.0</span></a></h2><h4 id="特征" tabindex="-1"><a class="header-anchor" href="#特征"><span>特征：</span></a></h4><ul><li>兼容HTTP/1.1，基于TCP，使用二进制传输</li><li>语义不改变，只是全部都是小写</li><li>语法改变大，HTTP报文的传输格式改变</li><li>&quot;h2&quot;表示使用 TLS加密（HTTPS）的HTTP/2.0，&quot;h2c&quot;非加密(HTTP)</li></ul><h4 id="http-2-0-的改进" tabindex="-1"><a class="header-anchor" href="#http-2-0-的改进"><span>HTTP/2.0 的改进：</span></a></h4><h5 id="hpack头部压缩" tabindex="-1"><a class="header-anchor" href="#hpack头部压缩"><span><code>HPACK头部压缩</code>：</span></a></h5><ul><li>静态表编码： <ul><li>共61组，HTTP/2.0协议内默认编码好了</li></ul></li><li>动态表编码： <ul><li>非静态表的头部，由客户端和服务端自行构建</li><li>仅对同一个TCP连接生效、当出现重复传输完全相同的HTTP头部时，才会起作用</li><li>存放在内存中，如果连接一直占用，可能会占用较高内存</li></ul></li><li>Huffman 编码（压缩算法） <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/c4803aa491fcfd5ebfde9045d606c748.png" alt="Img" loading="lazy"></li><li>存在的问题： <ul><li><code>HPACK队头阻塞问题</code>：动态表发生变化+并发下，如果完整的编码未被接收，会导致后续压缩结果无法被发送，造成队头阻塞</li></ul></li></ul><h5 id="二进制格式编码" tabindex="-1"><a class="header-anchor" href="#二进制格式编码"><span><code>二进制格式编码</code>：</span></a></h5><ul><li><p>HTTP/1.1 使用<code>文本</code>，HTTP/2.0 使用<code>二进制</code></p></li><li><p>化整为零，将传输信息（header+body）分割为更小的帧 <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/6d7699ba78eba5dae358267adbf382e8.png" alt="Img" loading="lazy"></p></li><li><p>名词解释：</p><ul><li><code>HEADERS 帧</code>：传输请求Header 内容</li><li><code>DATA 帧</code>：传输请求正文（多个 Data帧属于同一个流，有先后顺序）</li><li><code>Frame Header</code>：帧头（属于帧内的结构）</li><li><code>Frame Payload</code>：帧数据（属于帧内的结构）</li></ul></li><li><p><code>h2</code>包解析： <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/c42e845055af9f5a4ceb78dafd14087a.png" alt="Img" loading="lazy"></p></li></ul><h5 id="多路复用" tabindex="-1"><a class="header-anchor" href="#多路复用"><span><code>多路复用</code>：</span></a></h5><ul><li>含义： <ul><li>一条 TCP 连接在同一时间可以跑多个Stream</li></ul></li><li>TCP connection、stream、message、frame的关系： <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/22170a9e46dad8ff73adff878d2ede0a.png" alt="Img" loading="lazy"><ul><li><code>connection</code>可以有多个<code>Stream</code></li><li><code>Stream</code>包含两个<code>Message</code>，<code>请求message</code>和<code>响应message</code></li><li><code>Message</code>包含一个或者多个<code>Frame</code>（Message 对应 HTTP/1 中的请求或响应）</li><li><code>Frame</code>是 HTTP/2 最小单位，以二进制压缩存放 HTTP/1 中的头部和包体，<code>Frame</code>是有顺序的，一个 Frame 可以由多个 TCP 报文构成`</li></ul></li></ul><h5 id="服务器推送-server-push-cache-push" tabindex="-1"><a class="header-anchor" href="#服务器推送-server-push-cache-push"><span><code>服务器推送</code>（Server Push/ Cache Push）</span></a></h5><ul><li>作用： <ul><li>将可能会用到的数据先发送给客户端<code>缓存</code>下来</li></ul></li><li>服务端推送时创建的stream ID是偶数</li><li>客户端请求时创建的stream ID是奇数</li></ul><h5 id="解决http的队头阻塞" tabindex="-1"><a class="header-anchor" href="#解决http的队头阻塞"><span><code>解决HTTP的队头阻塞</code></span></a></h5><ul><li>通过<code>Stream</code>多路复用解决</li><li>同一个tcp连接中，http1的请求需要排队等待http事务完成后才能进行下一个（默认不开启<code>pipeline</code>，即使开启，服务端响应需要有序返回，这样也会阻塞）；</li><li>http2使用流可以在同一个tcp中实现并发</li></ul><h4 id="http-2-0-未解决的问题" tabindex="-1"><a class="header-anchor" href="#http-2-0-未解决的问题"><span>HTTP/2.0 未解决的问题：</span></a></h4><ul><li><code>TCP队头阻塞问题</code><ul><li>发生丢包时依赖tcp重传，得等到收到数据包后才能继续处理后续的流</li></ul></li><li><code>网络迁移</code>需要重新建立TCP连接 <ul><li>一个 TCP 连接是由四元组确定，IP地址或者端口变动，就需要TCP与 TLS重新握手（TCP存在连接状态导致，UDP无该问题）</li></ul></li></ul><h4 id="帧协议格式" tabindex="-1"><a class="header-anchor" href="#帧协议格式"><span>帧协议格式：</span></a></h4><figure><img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/048a9b0325f365cd4f0bc626fa106ebf.png" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><ul><li><p>帧长度：</p><ul><li>单个帧最大2^24 = 16M</li></ul></li><li><p>帧类型：</p><ul><li>大致可以分成： <ul><li>数据帧：HEADERS 、DATA</li><li>控制帧：SETTINGS、PING、PRIORITY等</li></ul></li><li>此外 gRPC 定义了几种自用的新帧类型。</li></ul></li><li><p>帧标志：</p><ul><li><code>End Headers</code>：表示header传输结束，在<code>HEADERS帧</code>使用</li><li><code>End stream</code>：表示客户端或者服务端单方面数据传输结束，在<code>HEADRS帧</code>(get)、<code>DATA帧</code>（post）使用</li><li><code>Padded</code>：表示该流是用来填充的，在任意帧都使用</li><li><code>Ack</code>：表示确认，在<code>PING帧</code>、<code>SETTING帧</code>中使用</li></ul></li><li><p>流标识符：<code>Stream ID</code></p><ul><li>流 ID 是<code>递增</code>的： <ul><li>客户端发起的 ID 是奇数</li><li>服务器端发起的 ID 是偶数</li></ul></li><li>流是<code>可并发</code>的： <ul><li>一个连接上可以同时有多个流，即“多路复用”也就是并发多请求；</li></ul></li><li>流是<code>双向的</code>： <ul><li>客户端和服务器都可以创建流，双方互不干扰</li><li>一个流对应一次http请求、响应</li></ul></li><li>流之间是<code>独立的</code>： <ul><li>但流内部的帧是有严格顺序的</li></ul></li><li>流是有<code>优先级</code>的： <ul><li>在流上发送<code>PRIORITY帧</code>，让服务器优先处理某些流</li><li>e.g. 先传 HTML/CSS，后传图片，优化用户体验</li></ul></li><li>流是<code>可取消</code>的： <ul><li>在流上发送<code>RST_STREAM帧</code>可以随时终止流，取消接收或发送</li></ul></li><li>第0号流比较特殊，不能关闭，也不能发送数据帧，只能发送控制帧，用于流量控制。</li></ul></li></ul><h4 id="数据收发" tabindex="-1"><a class="header-anchor" href="#数据收发"><span>数据收发：</span></a></h4><ul><li>从不同层对应的消息： <ul><li>在“流”内看，消息由有序的“帧”序列组成</li><li>在“TCP”的层面上看，消息是乱序收发的“帧” <ul><li>多个请求/响应之间没有了顺序关系，不需要根据请求顺序排队等待 <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/8fae57c8dcf3faf0f41577042bd9ec58.png" alt="图片" loading="lazy"><img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/7ddf8f4fadc857fe081fd2008950a987.png" alt="图片" loading="lazy"></li></ul></li></ul></li><li>数据发送过程： <ol><li>发送方将多个请求分到多个流中，然后将请求内容拆成帧，进行二进制传输</li><li>多个请求的帧，在传输层打散乱序发送</li><li>接收方根据每个帧首部的流标识符重新进行组装</li><li>可以根据优先级，决定优先处理哪个流的数据</li><li>因为TCP滑动窗口的原因，如果某个包没被确认，虽然后续包已到达，也不会被确认，而是一直阻塞</li><li>1.1 vs 2.0 发送示意图： <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/0e49e74abc6c7694352d3642d59bdb5d.png" alt="图片" loading="lazy"></li></ol></li></ul><h2 id="http-3-0-http-over-quic" tabindex="-1"><a class="header-anchor" href="#http-3-0-http-over-quic"><span>HTTP/3.0（HTTP-over-QUIC）</span></a></h2><ul><li>在HTTP/3.0中，数据流由传输层QUIC提供，而在HTTP/2中，流由HTTP层完成</li></ul><h3 id="quic" tabindex="-1"><a class="header-anchor" href="#quic"><span>QUIC：</span></a></h3><ul><li>特征： <ul><li>QUIC 基于UDP，是一个自己处理数据流的<code>传输层协议</code>，自身实现了TCP的一些特性</li><li>QUIC 使用且必须用TLS 1.3传输层安全协议</li><li>QUIC流 可以是单向的、也可以是双向的，由发起端决定</li><li>QUIC 在用户空间中实现，使用QUIC意味着选择了套接字API之外的另一套API</li><li>建立过程：可能在首次握手时协商使用HTTP/2协议，通过Alt-Svc头部，服务器通告客户端它对HTTP/3的支持与偏好。所以首次连接可能会有TCP连接和UDP同时进行（跟DNS解析ipv4和ipv6同时进行类似） <ul><li>e.g. Alt-Svc: h3=&quot;:50781&quot;，建议客户端使用UDP端口50781提供的HTTP/3</li></ul></li></ul></li></ul><h4 id="解决http-2-0-的问题" tabindex="-1"><a class="header-anchor" href="#解决http-2-0-的问题"><span>解决HTTP/2.0 的问题：</span></a></h4><ul><li>TCP 队头阻塞： <ul><li>QUIC的流基于UDP连接，每个流相互独立，互不影响（因为UDP不管顺序，不管丢包，所以传输层没有阻塞问题）</li></ul></li><li>TCP 建立连接的延迟更低： <ul><li>HTTP2.0：tcp + tls = 1RTT +2 RTT</li><li>QUIC：传输层握手和tls合并</li></ul></li><li>网络迁移（wifi和蜂窝互换）需要重新建立TCP连接 <ul><li>HTTP2.0 基于TCP，tcp 五元组唯一确认一个连接</li><li>QUIC 基于UDP，使用唯一的<code>connection id</code>，端口号同UDP端口</li></ul></li></ul><h4 id="quic协议" tabindex="-1"><a class="header-anchor" href="#quic协议"><span>QUIC协议：</span></a></h4><ul><li>总览：</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>UDP Header</span></span>
<span class="line"><span>  Packet Header                   -----</span></span>
<span class="line"><span>      QUIC Frame Header           --  TLS1.3</span></span>
<span class="line"><span>          HTTP3 Frame Header      -- </span></span>
<span class="line"><span>              HTTP Message        -----</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/1e1b1cd669b4881acee9400ff91bb680.png" alt="Img" tabindex="0" loading="lazy"><figcaption>Img</figcaption></figure><ul><li><p>Packet（负责连接可靠）：</p><ul><li>定义<code>Connection ID</code>，类似TCP连接四元组 <ul><li>64比特位（8字节）整数标识</li></ul></li><li><code>Packet Number</code>实现了类似TCP的可靠的连接 <ul><li>重传：当 UDP 报文丢失后，通过 Packet Header 中的 Packet Number 实现报文重传。</li><li>Packet Number 单调递增，重传的包Packet Number不一样： <ul><li>RTT是精确的，没有TCP重传导致的RTT歧义</li><li><code>包可以被乱序确认</code><ul><li>通过<code>Stream ID</code> + <code>Offset</code>可以确认是同一个包，即使packet Number不一样</li></ul></li></ul></li></ul></li><li><code>Connection ID</code>实现了连接迁移： <ul><li>记录<code>Destination Connection ID</code>，在客户端 IP 地址、端口变化后，绕过 UDP 四元组，继续维持连接</li></ul></li><li>一个 Packet 报文中可以存放多个 <code>QUIC Frame</code>，不能超过PMTUD（1200字节） <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/f443e834f43f34c9e2e0647d29b8c24c.png" alt="Img" loading="lazy"></li><li>上图Area Data即多个<code>QUIC Frame</code>，即在一个connection 中并发多个请求</li></ul></li><li><p>QUIC Frame（负责字节流有序）：</p><ul><li>一个Frame不可跨越多个Packet传输</li><li><code>Frame Type</code>： <ul><li>定义不同类型的Frame <ul><li><code>QUIC STREAM Frame</code> 应用层数据传输</li><li><code>other Frame</code> 状态管理 <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/c33058203fdba04e7b5337171eaf8756.png" alt="Frame通用头" loading="lazy"></li></ul></li></ul></li><li><code>QUIC STREAM Frame</code><ul><li><code>Stream Id</code> 实现有序的字节流： <ul><li>在无序的 Packet 报文中，<code>Stream Id</code>相同表示同一个HTTP消息（消息过大时，可跨Packet传输）</li><li>最低2位比特位用于识别连接的类型（单向、双向、发起者） <ul><li>最低1比特位表示流的发起者： <ul><li>0：双数流，客户端发起； 1：单数流，服务器发起</li></ul></li><li>第2个比特位识别单/双向流： <ul><li>0：双向；1：单向</li></ul></li></ul></li></ul></li><li><code>offset</code>用于重建字节流，实现消息的序列化： <ul><li>通过Offset字段完成类似于TCP协议中的Sequence序号，进行累计确认</li></ul></li><li><code>Length</code> 指明了Frame数据的长度</li><li>以下为QUIC STREAM Frame格式： <ul><li>Stream Data即HTTP/3 Frame <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/7569ef8b54999da315b58a34914cf392.png" alt="Stream Frame" loading="lazy"></li></ul></li></ul></li></ul></li><li><p>HTTP/3 Frame（负责HTTP语义）： <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/d1d2180748b4f6e04c42da9e54754b2a.png" alt="HTTP3 通用Frame头信息" loading="lazy"></p><ul><li><code>Type</code>：类似 HTTP/2的帧类型： <ul><li>DATA帧、HEADERS帧、SETTINGS帧、GOAWAY帧、MAX_PUSH_ID帧（限制服务器推送消息数量）</li></ul></li><li><code>Frame Payload</code>： <ul><li>存放二进制的 <code>HTTP message</code></li></ul></li><li>作用： <ul><li>可跨越多个Packet</li><li>实现服务器推送</li><li>实现 QPACK 编解</li><li>权重优先级设定</li><li>流量控制</li></ul></li></ul></li><li><p>HTTP Message（具体消息内容）：</p><ul><li>通用HTTP协议数据，header、body等</li></ul></li></ul><h4 id="quic机制" tabindex="-1"><a class="header-anchor" href="#quic机制"><span>QUIC机制：</span></a></h4><h5 id="自定义连接" tabindex="-1"><a class="header-anchor" href="#自定义连接"><span>自定义连接：</span></a></h5><ul><li>不再以四元组标识，而是以一个64位的随机数作为Connection ID来标识</li><li>加密算法的版本协商与传输层握手合并完成，以减小延迟</li></ul><h5 id="自定义重传机制" tabindex="-1"><a class="header-anchor" href="#自定义重传机制"><span>自定义重传机制：</span></a></h5><ul><li><code>Packet Number</code>（数据包编号）：在QUIC协议中，每个数据包都有一个唯一的编号，用于标识数据包在传输过程中的顺序和重传情况。Packet Number 用于确保数据包按正确的顺序传输，并在需要时进行重传</li></ul><h5 id="无阻塞的多路复用" tabindex="-1"><a class="header-anchor" href="#无阻塞的多路复用"><span>无阻塞的多路复用：</span></a></h5><ul><li>同一条 QUIC Connection Id上可以创建多个 stream 来发送多个请求(跟HTTP 2.0 一致)</li><li><code>QUIC为每个Stream分配独立的滑动窗口</code>。在传输层面如果出现丢包，只影响包所在的stream，其他stream无需等待。（跟HTTP2.0差异点，因为是基于UDP的）</li></ul><h5 id="自定义流量控制" tabindex="-1"><a class="header-anchor" href="#自定义流量控制"><span>自定义流量控制：</span></a></h5><ul><li>stream级别的滑动窗口： <ol><li>QUIC 通过 <code>window_update帧</code>来告诉对端它可以接受的字节数</li><li>QUIC 窗口的起始位置为当前收到的最大 offset</li><li>QUIC 的 ACK 是基于 offset 的，每个 offset 的包来了，进了缓存，就可以应答（相信中间的空档一定会到来）</li><li><code>QUIC为每个Stream分配独立的滑动窗口</code>，相互之间不影响 窗口示意图：TCP 和 QUIC <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/6fda22d5782f5f61402846f9e21d018a.png" alt="图片" loading="lazy"></li><li>可用窗口左边界： <ul><li>TCP：<code>已确认的</code>序号</li><li>QUIC：<code>收到的</code>最大Offset</li></ul></li></ol></li><li>连接级别的流量控制窗口： <ul><li>对所有的stream做整体大小控制</li></ul></li></ul><h5 id="服务器推送-server-push-cache-push-1" tabindex="-1"><a class="header-anchor" href="#服务器推送-server-push-cache-push-1"><span><code>服务器推送</code>（Server Push/ Cache Push）</span></a></h5><ul><li>作用： <ul><li>将可能会用到的数据先发送给客户端<code>缓存</code>下来，需要客户端同意</li></ul></li><li>过程： <ul><li>服务器通过请求流发送一个 <code>PUSH_PROMISE 帧</code>，使该推送请求看上去像是一个响应，然后通过<code>新的流</code>发送实际推送数据</li><li>客户端可随时通过<code>CANCEL_PUSH</code> 帧取消推送</li><li>客户端可以设置推送次数限制</li></ul></li></ul><h4 id="http-3-0机制" tabindex="-1"><a class="header-anchor" href="#http-3-0机制"><span>HTTP/3.0机制</span></a></h4><h5 id="头部压缩" tabindex="-1"><a class="header-anchor" href="#头部压缩"><span><code>头部压缩</code>：</span></a></h5><ul><li>QPACK： <ul><li>为什么要改HPACK： <ul><li>由于动态表具有时序性，QUIC中数据流互相独立，并发下因为可能还未建立动态表会导致失败</li></ul></li><li>QPACK使用两个额外的单向QUIC流，用于在两个方向上<code>传递动态表信息</code><ul><li><p><code>QPACK Encoder Stream</code>：用于传输动态表信息 <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/f02bf0f32626d8a7f3e43ecb3efc4291.png" alt="Img" loading="lazy"></p></li><li><p><code>QPACK Decoder Stream</code>：用于对传输内容的确认响应 <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/d5a20c3165d8a69314170350c88d2dab.png" alt="Img" loading="lazy"></p></li></ul></li></ul></li></ul><h5 id="二进制格式编码-1" tabindex="-1"><a class="header-anchor" href="#二进制格式编码-1"><span><code>二进制格式编码</code>：</span></a></h5><ul><li>同HTTP2.0相似，将传输信息（header+body）分割为更小的帧 <img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/1e1b1cd669b4881acee9400ff91bb680.png" alt="Img" loading="lazy"></li></ul><h5 id="http-3-0-frame" tabindex="-1"><a class="header-anchor" href="#http-3-0-frame"><span>HTTP/3.0 Frame：</span></a></h5><figure><img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/386bc276ab8dd65901f640bd19e7a20d.png" alt="Img" tabindex="0" loading="lazy"><figcaption>Img</figcaption></figure><ul><li>帧类型与HTTP2基本相同</li><li>流的相关功能前置到传输层QUIC实现</li><li>头部压缩算法使用QPACK</li></ul><h2 id="对比" tabindex="-1"><a class="header-anchor" href="#对比"><span>对比：</span></a></h2><figure><img src="https://raw.staticdn.net/Navyum/imgbed/pic/IMG/66735265a54c7ed385a2a94b88e4cda4.png" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><ul><li>参考： <ul><li><a href="https://http3-explained.haxx.se/zh/why-QUIC/why-tcphol" target="_blank" rel="noopener noreferrer">https://http3-explained.haxx.se/zh/why-QUIC/why-tcphol</a></li><li><a href="https://xiaolincoding.com/network" target="_blank" rel="noopener noreferrer">https://xiaolincoding.com/network</a></li><li><a href="https://kiosk007.top/post/quic-%E5%8D%8F%E8%AE%AE/" target="_blank" rel="noopener noreferrer">https://kiosk007.top/post/quic-%E5%8D%8F%E8%AE%AE/</a></li></ul></li></ul></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><span class="vp-meta-info" data-allow-mismatch="text">2025/6/23 09:35:21</span></div><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/05.%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%81TCP%EF%BC%88%E5%9B%9B%E5%B1%82%EF%BC%89.html" aria-label="05.传输层、TCP（四层）" iconsizing="both"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><iconify-icon class="vp-icon" icon="bxs:hot" height="1em" sizing="height"></iconify-icon>05.传输层、TCP（四层）</div></a><a class="route-link auto-link next" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/07.%E7%BD%91%E7%BB%9CIO%E6%8A%80%E6%9C%AF-%E9%98%BB%E5%A1%9E%E3%80%81%E9%9D%9E%E9%98%BB%E5%A1%9E%E3%80%81%E5%90%8C%E6%AD%A5%E3%80%81%E5%BC%82%E6%AD%A5.html" aria-label="09.网络IO-阻塞、同步" iconsizing="both"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">09.网络IO-阻塞、同步<iconify-icon class="vp-icon" icon="zondicons:network" height="1em" sizing="height"></iconify-icon></div></a></nav><div id="comment" class="waline-wrapper vp-comment" vp-comment darkmode="false" style="display:block;"><!----></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><!----><div class="vp-copyright">
  版权声明：自由转载 - 非商用 - 非衍生 - 保持署名<a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh-hans" target="_blank" rel="noopener noreferrer">（创意共享 4.0 许可证）</a>|
  Copyright © 2024-present Navyum</a>
  </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.4343b326.js" defer></script><script src="/assets/js/1181.88d0b359.js" defer></script><script src="/assets/js/app.0aa5305f.js" defer></script>
    <!-- 看板娘区块 -->
    <script src="/live2d-widget/autoload.js"></script>
    <!-- End 看板娘区块 -->

    <!-- ahrefs分析-->
    <script src="https://analytics.ahrefs.com/analytics.js" data-key="7WraP4W+AhiZ1hvRy398kQ" async></script>

  </body>
</html>
